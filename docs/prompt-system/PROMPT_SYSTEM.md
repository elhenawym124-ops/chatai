# ๐ ูุธุงู ุงูุจุฑููุจุช ุงููุฎุตุต
## Custom Prompt System Documentation

## ๐ฏ **ูุธุฑุฉ ุนุงูุฉ**

ูุธุงู ุงูุจุฑููุจุช ุงููุฎุตุต ูู ุงูููุจ ุงูุฐู ูุญุฏุฏ ุดุฎุตูุฉ ูุณููู ุงูุจูุช. ูุชูุญ ูููุฏูุฑูู ุฅูุดุงุก ูุชุฎุตูุต ุดุฎุตูุงุช ูุฎุชููุฉ ููุจูุช ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุดุฑูุฉ ูุงูุนููุงุก.

## ๐๏ธ **ุจููุฉ ุงููุธุงู**

### **ููููุงุช ุงููุธุงู:**
```mermaid
graph TD
    A[Admin Interface] --> B[Prompt Management]
    B --> C[System Prompts Table]
    C --> D[AI Agent Service]
    D --> E[getCompanyPrompts()]
    E --> F[buildAdvancedPrompt()]
    F --> G[Gemini AI]
```

### **ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
-- ุงูุฌุฏูู ุงูุฑุฆูุณู ููุจุฑููุจุชุงุช
CREATE TABLE system_prompts (
  id VARCHAR(191) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  category VARCHAR(100),
  isActive BOOLEAN DEFAULT false,
  companyId VARCHAR(191),
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ุฌุฏูู ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุงุญุชูุงุทู)
CREATE TABLE ai_settings (
  id VARCHAR(191) PRIMARY KEY,
  companyId VARCHAR(191) NOT NULL,
  personalityPrompt TEXT,
  responsePrompt TEXT,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## ๐ **ุชุฑุชูุจ ุงูุฃููููุงุช**

### **ูุธุงู ุงูุฃููููุงุช ุงููุฑูู:**
```javascript
async getCompanyPrompts(companyId) {
  // 1. ุงูุฃููููุฉ ุงูุฃููู: system_prompts (ุงูุจุฑููุจุช ุงููุดุท)
  const activeSystemPrompt = await prisma.systemPrompt.findFirst({
    where: { isActive: true },
    orderBy: { updatedAt: 'desc' }
  });
  
  if (activeSystemPrompt) {
    return {
      personalityPrompt: activeSystemPrompt.content,
      source: 'system_prompt',
      promptName: activeSystemPrompt.name
    };
  }
  
  // 2. ุงูุฃููููุฉ ุงูุซุงููุฉ: ai_settings
  const aiSettings = await prisma.aiSettings.findFirst({
    where: { companyId }
  });
  
  if (aiSettings && aiSettings.personalityPrompt) {
    return {
      personalityPrompt: aiSettings.personalityPrompt,
      source: 'ai_settings'
    };
  }
  
  // 3. ุงูุฃููููุฉ ุงูุซุงูุซุฉ: company table
  const company = await prisma.company.findUnique({
    where: { id: companyId }
  });
  
  if (company && company.personalityPrompt) {
    return {
      personalityPrompt: company.personalityPrompt,
      source: 'company'
    };
  }
  
  // 4. ุงูุจุฑููุจุช ุงูุงูุชุฑุงุถู
  return {
    personalityPrompt: null,
    source: 'default'
  };
}
```

## ๐ **ุจูุงุก ุงูุจุฑููุจุช ุงููุชูุฏู**

### **ูุฑุงุญู ุงูุจูุงุก:**

#### **1. ุงูุจุฑููุจุช ุงูุฃุณุงุณู**
```javascript
// ุฅุฐุง ูุฌุฏ ุจุฑููุจุช ูุฎุตุต
if (companyPrompts.personalityPrompt) {
  prompt += `${companyPrompts.personalityPrompt}\n\n`;
} else {
  // ุงูุจุฑููุจุช ุงูุงูุชุฑุงุถู
  prompt += `ุฃูุช ุณุงุฑูุ ูุณุงุนุฏุฉ ูุจูุนุงุช ุฐููุฉ ูุทุจูุนูุฉ ูู ูุชุฌุฑ ุฅููุชุฑููู:
- ุชุชุญุฏุซูู ุจุทุฑููุฉ ูุฏูุฏุฉ ูููููุฉ
- ุชุณุชุฎุฏููู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุงุถุญุฉ
- ุชููููู ููุฉ ุงูุนููู ูุจู ุงูุชุฑุงุญ ุงูููุชุฌุงุช
- ุชูุฏููู ูุนูููุงุช ุฏูููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช\n\n`;
}
```

#### **2. ูุนูููุงุช ุงูุนููู**
```javascript
prompt += `ูุนูููุงุช ุงูุนููู:
- ุงูุงุณู: ${customerData?.name || 'ุนููู ุฌุฏูุฏ'}
- ุงููุงุชู: ${customerData?.phone || 'ุบูุฑ ูุญุฏุฏ'}
- ุนุฏุฏ ุงูุทูุจุงุช ุงูุณุงุจูุฉ: ${customerData?.orderCount || 0}\n\n`;
```

#### **3. ุฐุงูุฑุฉ ุงููุญุงุฏุซุฉ**
```javascript
if (conversationMemory && conversationMemory.length > 0) {
  prompt += `๐ ุณุฌู ุงููุญุงุฏุซุฉ ุงูุณุงุจูุฉ (ููุณูุงู):\n`;
  prompt += `=====================================\n`;
  
  conversationMemory.forEach((interaction, index) => {
    const timeAgo = this.getTimeAgo(new Date(interaction.timestamp));
    prompt += `${index + 1}. ููุฐ ${timeAgo}:\n`;
    prompt += `   ุงูุนููู: ${interaction.userMessage}\n`;
    prompt += `   ุฑุฏู: ${interaction.aiResponse}\n\n`;
  });
  
  prompt += `=====================================\n\n`;
}
```

#### **4. ุจูุงูุงุช RAG**
```javascript
if (ragData && ragData.length > 0) {
  prompt += `๐๏ธ ุงููุนูููุงุช ุงููุชุงุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:\n`;
  prompt += `=====================================\n`;
  
  ragData.forEach((item, index) => {
    if (item.type === 'product') {
      prompt += `๐๏ธ ููุชุฌ ${index + 1}: ${item.content}\n`;
    } else if (item.type === 'faq') {
      prompt += `โ ุณุคุงู ุดุงุฆุน ${index + 1}: ${item.content}\n`;
    } else if (item.type === 'policy') {
      prompt += `๐ ุณูุงุณุฉ ${index + 1}: ${item.content}\n`;
    }
  });
  
  prompt += `=====================================\n\n`;
}
```

#### **5. ุงูุฑุณุงูุฉ ูุงูุชุนูููุงุช ุงูููุงุฆูุฉ**
```javascript
prompt += `ุฑุณุงูุฉ ุงูุนููู: "${customerMessage}"\n\n`;

prompt += `๐ฏ ุชุนูููุงุช ุงูุฑุฏ ุงูููุงุฆูุฉ:
1. โ ุงุณุชุฎุฏูู ููุท ุงููุนูููุงุช ุงูููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃุนูุงู
2. ๐ซ ูุง ุชุฐูุฑู ุฃู ููุชุฌุงุช ุฃู ูุนูููุงุช ุบูุฑ ููุฌูุฏุฉ ูู ุงููุงุฆูุฉ
3. ๐ฐ ุงุฐูุฑู ุงูุฃุณุนุงุฑ ูุงูุชูุงุตูู ุงูุฏูููุฉ ููุง ูู ููุชูุจุฉ
4. ๐ ุฅุฐุง ุณุฃู ุนู ููุชุฌุงุชุ ุงุนุฑุถู ุงูููุชุฌุงุช ุงููุชุงุญุฉ ุจุงูุชูุตูู
5. โ ุฅุฐุง ูู ููู ุงูููุชุฌ ูู ุงููุงุฆูุฉุ ูููู ุฃูู ุบูุฑ ูุชููุฑ ุญุงููุงู
6. ๐ฃ๏ธ ุงุณุชุฎุฏูู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงูุทุจูุนูุฉ ูุงููุฏูุฏุฉ`;
```

## ๐จ **ุฃูุซูุฉ ุงูุจุฑููุจุชุงุช**

### **ุจุฑููุจุช ุฎุฏูุฉ ุนููุงุก ูุฏูุฏ:**
```
ุงูุชู ุงุณูู ุณุงุฑูุ ูุณุงุนุฏุฉ ูุจูุนุงุช ุฐููุฉ ููุฏูุฏุฉ ูู ูุชุฌุฑ ุฅููุชุฑููู.

ุดุฎุตูุชู:
- ูุฏูุฏุฉ ููุฑุญุจุฉ ุฏุงุฆูุงู
- ุชุณุชุฎุฏูู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงูุนุงููุฉ ุงููุตุฑูุฉ
- ุชุญุจู ูุณุงุนุฏุฉ ุงูุนููุงุก ูุชูุฏูู ุฃูุถู ุฎุฏูุฉ
- ุตุจูุฑุฉ ููุชูููุฉ ูุงุญุชูุงุฌุงุช ุงูุนููุงุก

ุฃุณููุจู ูู ุงูุฑุฏ:
- ุงุจุฏุฆู ุจุชุญูุฉ ูุฏูุฏุฉ
- ุงุณุชุฎุฏูู ุงูุฅูููุฌู ุจุดูู ููุงุณุจ ๐
- ุงุณุฃูู ุนู ุงุญุชูุงุฌุงุช ุงูุนููู ุจูุถูุญ
- ูุฏูู ุงููุนูููุงุช ุจุทุฑููุฉ ููุธูุฉ ููููููุฉ

ูุนูููุงุช ูููุฉ:
- ุงูุดุญู ูุฌุงูู ููุทูุจุงุช ููู 200 ุฌููู
- ุงูุดุญู ูููุงูุฑุฉ ูุงูุฌูุฒุฉ: 30 ุฌููู
- ุงูุดุญู ูููุญุงูุธุงุช: 50 ุฌููู
- ูููู ุงูุฅุฑุฌุงุน ุฎูุงู 14 ููู
```

### **ุจุฑููุจุช ุฎุฏูุฉ ุนููุงุก ุฑุณูู:**
```
ุฃูุช ูุณุงุนุฏ ุฎุฏูุฉ ุนููุงุก ูุญุชุฑู ูู ุดุฑูุฉ ุชุฌุงุฑุฉ ุฅููุชุฑูููุฉ.

ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ:
- ุงูุงุญุชุฑุงููุฉ ูู ุงูุชุนุงูู
- ุงูุฏูุฉ ูู ุงููุนูููุงุช
- ุงูุณุฑุนุฉ ูู ุงูุงุณุชุฌุงุจุฉ
- ุงููุถูุญ ูู ุงูุชูุงุตู

ุฅุฑุดุงุฏุงุช ุงูุฑุฏ:
- ุงุณุชุฎุฏู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู
- ูุฏู ุงููุนูููุงุช ุจุดูู ููุธู ููุฑูู
- ุงุฐูุฑ ุฌููุน ุงูุชูุงุตูู ุงููุทููุจุฉ
- ุชุฃูุฏ ูู ููู ุงูุนููู ูุจู ุฅููุงุก ุงููุญุงุฏุซุฉ

ุณูุงุณุงุช ุงูุดุฑูุฉ:
- ุณุงุนุงุช ุงูุนูู: ูู 9 ุตุจุงุญุงู ุฅูู 6 ูุณุงุกู
- ุฎุฏูุฉ ุงูุนููุงุก ูุชุงุญุฉ ุทูุงู ุงูุฃุณุจูุน
- ูุชู ุงูุฑุฏ ุนูู ุงูุงุณุชูุณุงุฑุงุช ุฎูุงู 24 ุณุงุนุฉ
```

### **ุจุฑููุจุช ูุชุฎุตุต ูู ุงูููุชุฌุงุช:**
```
ุงูุชู ุฎุจูุฑุฉ ููุชุฌุงุช ูู ูุชุฌุฑ ุงูุฃุฒูุงุก ูุงูุฅูุณุณูุงุฑุงุช.

ุฎุจุฑุชู ุชุดูู:
- ูุนุฑูุฉ ุชูุตูููุฉ ุจุฌููุน ุงูููุชุฌุงุช
- ุงููุฏุฑุฉ ุนูู ุงูุชุฑุงุญ ุงูููุชุฌุงุช ุงูููุงุณุจุฉ
- ูุนุฑูุฉ ุจุฃุญุฏุซ ุตูุญุงุช ุงูููุถุฉ
- ุฎุจุฑุฉ ูู ุชูุณูู ุงูุฃููุงู ูุงูุฃุญุฌุงู

ุนูุฏ ุงูุชุนุงูู ูุน ุงูุนููุงุก:
- ุงุณุฃูู ุนู ุงูููุงุณุจุฉ ุฃู ุงูุงุณุชุฎุฏุงู ุงููุทููุจ
- ุงูุชุฑุญู ููุชุฌุงุช ูุชูุงููุฉ (outfit ูุงูู)
- ุงุฐูุฑู ุชูุงุตูู ุงูุฎุงูุงุช ูุงูุฃููุงู ุงููุชุงุญุฉ
- ูุฏูู ูุตุงุฆุญ ููุนูุงูุฉ ุจุงูููุชุฌุงุช

ูุนูููุงุช ุงูููุชุฌุงุช:
- ุฌููุน ุงูููุชุฌุงุช ุฃุตููุฉ ููุถูููุฉ
- ุชุชููุฑ ููุงุณุงุช ูู S ุฅูู XL
- ุฅููุงููุฉ ุงูุชุจุฏูู ุฎูุงู 7 ุฃูุงู
- ุฎุตููุงุช ุฎุงุตุฉ ููุนููุงุก ุงููููุฒูู
```

## โ๏ธ **ุฅุฏุงุฑุฉ ุงูุจุฑููุจุชุงุช**

### **ุฅูุดุงุก ุจุฑููุจุช ุฌุฏูุฏ:**
```javascript
// ุนุจุฑ ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
POST /api/ai/prompts
{
  "name": "ุฎุฏูุฉ ุนููุงุก ูุฏูุฏุฉ",
  "content": "ุงูุชู ุงุณูู ุณุงุฑู...",
  "category": "customer_service",
  "isActive": true
}
```

### **ุชูุนูู ุจุฑููุจุช:**
```javascript
// ุชูุนูู ุจุฑููุจุช ูุนูู
PUT /api/ai/prompts/:id/activate
{
  "isActive": true
}

// ุฅูุบุงุก ุชูุนูู ุฌููุน ุงูุจุฑููุจุชุงุช ุงูุฃุฎุฑู ุชููุงุฆูุงู
```

### **ุชุญุฏูุซ ุจุฑููุจุช:**
```javascript
PUT /api/ai/prompts/:id
{
  "name": "ุงุณู ูุญุฏุซ",
  "content": "ูุญุชูู ูุญุฏุซ...",
  "category": "ูุฆุฉ ุฌุฏูุฏุฉ"
}
```

## ๐งช **ุงุฎุชุจุงุฑ ุงูุจุฑููุจุชุงุช**

### **ุงุฎุชุจุงุฑ ุณุฑูุน:**
```javascript
// ุงุฎุชุจุงุฑ ุจุฑููุจุช ูุจู ุงูุชูุนูู
POST /api/ai/test-prompt
{
  "promptContent": "ุงูุจุฑููุจุช ุงููุฑุงุฏ ุงุฎุชุจุงุฑู...",
  "testMessage": "ูุฑุญุจุงุ ุฃุฑูุฏ ูุนุฑูุฉ ุงูููุชุฌุงุช ุงููุชุงุญุฉ"
}
```

### **ููุงุฑูุฉ ุงูุจุฑููุจุชุงุช:**
```javascript
// ููุงุฑูุฉ ุฑุฏูุฏ ุจุฑููุจุชุงุช ูุฎุชููุฉ
POST /api/ai/compare-prompts
{
  "prompts": [
    { "id": "prompt1", "name": "ุงูุจุฑููุจุช ุงูุฃูู" },
    { "id": "prompt2", "name": "ุงูุจุฑููุจุช ุงูุซุงูู" }
  ],
  "testMessage": "ุฑุณุงูุฉ ุงูุงุฎุชุจุงุฑ"
}
```

## ๐ **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**

### **ูุคุดุฑุงุช ุงูุฃุฏุงุก:**
- **ูุนุฏู ุงูุงุณุชุฌุงุจุฉ**: ุณุฑุนุฉ ุงูุฑุฏ ุนูู ุงูุฑุณุงุฆู
- **ุฏูุฉ ุงูุฑุฏูุฏ**: ูุฏู ุตุญุฉ ุงููุนูููุงุช ุงูููุฏูุฉ
- **ุฑุถุง ุงูุนููุงุก**: ุชูููู ุงูุนููุงุก ููุฑุฏูุฏ
- **ูุนุฏู ุงูุชุญููู**: ูุณุจุฉ ุชุญููู ุงููุญุงุฏุซุงุช ููุจูุนุงุช

### **ุชุญููู ุงูุงุณุชุฎุฏุงู:**
```javascript
// ุฅุญุตุงุฆูุงุช ุงูุจุฑููุจุช
GET /api/ai/prompts/:id/analytics
{
  "totalUsage": 1250,
  "averageResponseTime": "2.3s",
  "successRate": "94.5%",
  "customerSatisfaction": "4.2/5"
}
```

## ๐ง **ุฃูุถู ุงูููุงุฑุณุงุช**

### **ูุชุงุจุฉ ุงูุจุฑููุจุช:**
1. **ูุถูุญ ุงููููุฉ**: ุญุฏุฏ ุงุณู ูุดุฎุตูุฉ ุงูุจูุช ุจูุถูุญ
2. **ุชุนูููุงุช ูุญุฏุฏุฉ**: ุงูุชุจ ุชุนูููุงุช ูุงุถุญุฉ ููุญุฏุฏุฉ
3. **ุฃูุซูุฉ ุนูููุฉ**: ุฃุถู ุฃูุซูุฉ ููุฑุฏูุฏ ุงููุทููุจุฉ
4. **ุญุฏูุฏ ูุงุถุญุฉ**: ุญุฏุฏ ูุง ูุฌุจ ููุง ูุง ูุฌุจ ูุนูู

### **ุงูุชุญุณูู ุงููุณุชูุฑ:**
1. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ุฑุงูุจ ุฑุฏูุฏ ุงูุจูุช ุจุงุณุชูุฑุงุฑ
2. **ุฌูุน ุงูููุงุญุธุงุช**: ุงุฌูุน ููุงุญุธุงุช ุงูุนููุงุก ูุงููุฑูู
3. **ุงูุชุญุฏูุซ ุงูุฏูุฑู**: ุญุฏุซ ุงูุจุฑููุจุช ุจูุงุกู ุนูู ุงูููุงุญุธุงุช
4. **ุงูุงุฎุชุจุงุฑ ุงููุณุชูุฑ**: ุงุฎุชุจุฑ ุงูุชุบููุฑุงุช ูุจู ุงูุชุทุจูู

### **ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑุงุช:**
1. **ูุณุฎ ุงุญุชูุงุทูุฉ**: ุงุญุชูุธ ุจูุณุฎ ูู ุงูุจุฑููุจุชุงุช ุงูุณุงุจูุฉ
2. **ุชุณุฌูู ุงูุชุบููุฑุงุช**: ูุซู ุฌููุน ุงูุชุบููุฑุงุช ูุงูุฃุณุจุงุจ
3. **ุงุฎุชุจุงุฑ ูุฑุญูู**: ุงุฎุชุจุฑ ุนูู ูุฌููุนุฉ ูุญุฏูุฏุฉ ุฃููุงู
4. **ุฎุทุฉ ุงูุฑุฌูุน**: ุฌูุฒ ุฎุทุฉ ููุนูุฏุฉ ููุฅุตุฏุงุฑ ุงูุณุงุจู

---

## ๐ **ุงููุฑุงุฌุน ูุงูุฏุนู**

- [ูุธุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู](../ai-system/AI_SYSTEM_OVERVIEW.md)
- [ูุธุงู RAG](../rag-system/RAG_SYSTEM.md)
- [ุฏููู ุงููุฏูุฑ](../admin-guide/PROMPT_MANAGEMENT.md)
- [ุญู ูุดุงูู ุงูุจุฑููุจุช](../troubleshooting/PROMPT_ISSUES.md)
