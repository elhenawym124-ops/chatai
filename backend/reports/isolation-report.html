
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Isolation Security Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
        .header { background: #667eea; color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
        .stat { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }
        .critical { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .success { color: #28a745; font-weight: bold; }
        .issue { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #667eea; }
        .issue.critical { border-left-color: #dc3545; background: #fff5f5; }
        .issue.warning { border-left-color: #ffc107; background: #fffbf0; }
        .code { background: #f1f3f4; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔒 Company Isolation Security Report</h1>
        <p>Scan Date: 8/17/2025, 12:02:11 PM</p>
    </div>
    
    <div class="stats">
        <div class="stat">
            <div class="success" style="font-size: 2em;">179</div>
            <div>Files Scanned</div>
        </div>
        <div class="stat">
            <div style="font-size: 2em;">666</div>
            <div>Total Issues</div>
        </div>
        <div class="stat">
            <div class="critical" style="font-size: 2em;">31</div>
            <div>Critical Issues</div>
        </div>
        <div class="stat">
            <div class="warning" style="font-size: 2em;">635</div>
            <div>Warnings</div>
        </div>
    </div>
    
    <h2>🚨 Issues Found</h2>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:46</p>
        <div class="code">await prisma.$queryRaw`SELECT 1 as connection_test`;</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:86</p>
        <div class="code">await prisma.$queryRaw`SELECT 1 as health_check`;</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:152</p>
        <div class="code">const tables = await client.$queryRaw<Array<{ TABLE_NAME: string }>>`</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:161</p>
        <div class="code">await client.$executeRaw`SET FOREIGN_KEY_CHECKS = 0`;</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:167</p>
        <div class="code">await client.$executeRawUnsafe(`TRUNCATE TABLE \`${table.TABLE_NAME}\``);</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\config\database.ts:172</p>
        <div class="code">await client.$executeRaw`SET FOREIGN_KEY_CHECKS = 1`;</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:22</p>
        <div class="code">const { companyId } = req.user || { companyId: 'cmdkj6coz0000uf0cyscco6lr' };</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:28</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:32</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:36</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:53</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:373</p>
        <div class="code">where: { companyId: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:446</p>
        <div class="code">where: { id: id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\continuousLearningController_old.js:494</p>
        <div class="code">where: { id: id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\hybridAiController.js:162</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\controllers\hybridAiController.js:301</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\controllers\AIController.ts:161</p>
        <div class="code">where: { companyId: user.companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\controllers\AIController.ts:291</p>
        <div class="code">where: { id: customerId, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\controllers\AIController.ts:313</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\controllers\AIController.ts:325</p>
        <div class="code">where: { conversationId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:19</p>
        <div class="code">router.post('/generate-response', aiController.generateResponse);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:22</p>
        <div class="code">router.post('/analyze-sentiment', aiController.analyzeSentiment);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:23</p>
        <div class="code">router.post('/recommend-products', aiController.recommendProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:24</p>
        <div class="code">router.get('/insights/:conversationId', aiController.getConversationInsights);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:27</p>
        <div class="code">router.get('/analytics', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAnalytics);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:30</p>
        <div class="code">router.get('/settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:31</p>
        <div class="code">router.put('/settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:34</p>
        <div class="code">router.post('/test', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.testResponse);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:39</p>
        <div class="code">router.get('/models', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAvailableModels);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:40</p>
        <div class="code">router.get('/usage-stats', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getUsageStats);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:43</p>
        <div class="code">router.post('/generate-advanced-response', aiController.generateAdvancedResponse);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:48</p>
        <div class="code">router.get('/prompt-templates', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getPromptTemplates);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:51</p>
        <div class="code">router.get('/prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getCompanyPrompts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:52</p>
        <div class="code">router.put('/prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateCompanyPrompts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:53</p>
        <div class="code">router.post('/prompts/apply-template', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.applyTemplate);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:58</p>
        <div class="code">router.get('/static-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getStaticPrompts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:59</p>
        <div class="code">router.post('/static-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.createStaticPrompt);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:60</p>
        <div class="code">router.put('/static-prompts/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateStaticPrompt);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:61</p>
        <div class="code">router.delete('/static-prompts/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.deleteStaticPrompt);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:64</p>
        <div class="code">router.get('/business-templates', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getBusinessTemplates);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:65</p>
        <div class="code">router.get('/business-types', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getBusinessTypes);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:66</p>
        <div class="code">router.post('/business-templates/apply/:templateId', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.applyBusinessTemplate);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:69</p>
        <div class="code">router.get('/advanced-services/company-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAdvancedCompanyPrompts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:70</p>
        <div class="code">router.get('/advanced-services/active-services', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getActiveServices);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:71</p>
        <div class="code">router.get('/advanced-services/configuration', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAdvancedConfiguration);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:72</p>
        <div class="code">router.put('/advanced-services/configuration', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateAdvancedConfiguration);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:77</p>
        <div class="code">router.get('/product-settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getProductAiSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:78</p>
        <div class="code">router.put('/product-settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateProductAiSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:81</p>
        <div class="code">router.post('/recommend-products-advanced', aiController.recommendProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:82</p>
        <div class="code">router.post('/analyze-image', aiController.analyzeCustomerImage);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:83</p>
        <div class="code">router.post('/create-order', aiController.createOrderFromConversation);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\ai\routes\aiRoutes.ts:84</p>
        <div class="code">router.get('/product-image/:productId', aiController.getProductImage);</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:71</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:306</p>
        <div class="code">where: { id: customerId, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:326</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:387</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:544</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\ai\services\GeminiService.ts:600</p>
        <div class="code">where: { ...where, requiresHumanIntervention: true }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\middleware\authMiddleware.ts:37</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\middleware\authMiddleware.ts:174</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:16</p>
        <div class="code">router.post('/register', rateLimitMiddleware.register, authController.register);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:17</p>
        <div class="code">router.post('/login', rateLimitMiddleware.login, authController.login);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:18</p>
        <div class="code">router.post('/refresh', rateLimitMiddleware.refresh, authController.refreshToken);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:19</p>
        <div class="code">router.post('/forgot-password', rateLimitMiddleware.forgotPassword, authController.forgotPassword);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:20</p>
        <div class="code">router.post('/reset-password', rateLimitMiddleware.resetPassword, authController.resetPassword);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:21</p>
        <div class="code">router.post('/verify-email', authController.verifyEmail);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:22</p>
        <div class="code">router.post('/resend-verification', rateLimitMiddleware.resendVerification, authController.resendVerification);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:27</p>
        <div class="code">router.post('/logout', authController.logout);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:28</p>
        <div class="code">router.get('/me', authController.getProfile);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:29</p>
        <div class="code">router.put('/profile', authController.updateProfile);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\auth\routes\authRoutes.ts:30</p>
        <div class="code">router.post('/change-password', authController.changePassword);</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:79</p>
        <div class="code">where: { email: data.email }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:160</p>
        <div class="code">where: { email },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:188</p>
        <div class="code">where: { id: user.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:233</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:271</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:294</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:327</p>
        <div class="code">where: { id: userId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:345</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:362</p>
        <div class="code">where: { email }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:376</p>
        <div class="code">//   where: { id: user.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\auth\services\AuthService.ts:415</p>
        <div class="code">//   where: { id: user.id },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:8</p>
        <div class="code">router.post('/campaigns', broadcastController.createCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:9</p>
        <div class="code">router.get('/campaigns', broadcastController.getCampaigns.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:10</p>
        <div class="code">router.get('/campaigns/:id', broadcastController.getCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:11</p>
        <div class="code">router.put('/campaigns/:id', broadcastController.updateCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:12</p>
        <div class="code">router.delete('/campaigns/:id', broadcastController.cancelCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:13</p>
        <div class="code">router.post('/campaigns/:id/pause', broadcastController.pauseCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:14</p>
        <div class="code">router.post('/campaigns/:id/resume', broadcastController.resumeCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:15</p>
        <div class="code">router.post('/campaigns/:id/send', broadcastController.sendCampaign.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:18</p>
        <div class="code">router.get('/analytics', broadcastController.getAnalytics.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:19</p>
        <div class="code">router.get('/analytics/:campaignId', broadcastController.getCampaignAnalytics.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:22</p>
        <div class="code">router.get('/customer-lists', broadcastController.getCustomerLists.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:25</p>
        <div class="code">router.get('/settings', broadcastController.getSettings.bind(broadcastController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\broadcast\routes\broadcastRoutes.ts:26</p>
        <div class="code">router.put('/settings', broadcastController.updateSettings.bind(broadcastController));</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:108</p>
        <div class="code">where: { id: campaignId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:120</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:133</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:165</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:181</p>
        <div class="code">where: { id: campaignId, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:202</p>
        <div class="code">where: { id: campaignId, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:531</p>
        <div class="code">where: { id: campaignId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:543</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:556</p>
        <div class="code">where: { id: campaignId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:568</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:581</p>
        <div class="code">where: { id: campaignId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:595</p>
        <div class="code">where: { id: campaignId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:608</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\broadcast\services\BroadcastService.ts:640</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:105</p>
        <div class="code">router.get('/', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:130</p>
        <div class="code">router.get('/:id', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:159</p>
        <div class="code">router.get('/:id/messages', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:187</p>
        <div class="code">router.post('/:id/send', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:239</p>
        <div class="code">router.delete('/:id', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\conversations\routes\conversationRoutes.ts:282</p>
        <div class="code">router.post('/', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:19</p>
        <div class="code">router.get('/search', customerController.searchCustomers);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:22</p>
        <div class="code">router.get('/segments', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.getCustomerSegments);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:25</p>
        <div class="code">router.get('/export', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.exportCustomers);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:28</p>
        <div class="code">router.get('/', customerController.getCustomers);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:29</p>
        <div class="code">router.post('/', customerController.createCustomer);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:30</p>
        <div class="code">router.get('/:id', customerController.getCustomer);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:31</p>
        <div class="code">router.put('/:id', customerController.updateCustomer);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:32</p>
        <div class="code">router.delete('/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.deleteCustomer);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:35</p>
        <div class="code">router.get('/:id/interactions', customerController.getCustomerInteractions);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:36</p>
        <div class="code">router.get('/:id/stats', customerController.getCustomerStats);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:39</p>
        <div class="code">router.get('/:id/notes', customerController.getCustomerNotes);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\customers\routes\customerRoutes.ts:40</p>
        <div class="code">router.post('/:id/notes', customerController.addCustomerNote);</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:146</p>
        <div class="code">where: { id, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:252</p>
        <div class="code">where: { id, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:275</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:305</p>
        <div class="code">where: { id, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:314</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:332</p>
        <div class="code">where: { id: customerId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:363</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:380</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:413</p>
        <div class="code">where: { id: noteData.customerId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:447</p>
        <div class="code">where: { id: customerId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:458</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:485</p>
        <div class="code">where: { id: customerId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:508</p>
        <div class="code">where: { customerId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:511</p>
        <div class="code">where: { customerId, status: { not: 'CANCELLED' } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:515</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:586</p>
        <div class="code">this.prisma.customer.count({ where: { companyId } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:587</p>
        <div class="code">this.prisma.customer.count({ where: { companyId, status: 'ACTIVE' } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\customers\services\CustomerService.ts:588</p>
        <div class="code">this.prisma.customer.count({ where: { companyId, status: 'LEAD' } }),</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:16</p>
        <div class="code">router.get('/webhook', facebookController.verifyWebhook);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:17</p>
        <div class="code">router.post('/webhook', facebookController.handleWebhook);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:23</p>
        <div class="code">router.get('/pages', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.getPages);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:24</p>
        <div class="code">router.post('/connect', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.connectPage);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:25</p>
        <div class="code">router.delete('/:pageId', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.disconnectPage);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:28</p>
        <div class="code">router.get('/connected', facebookController.getConnectedPages);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:29</p>
        <div class="code">router.get('/status', facebookController.getIntegrationStatus);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:30</p>
        <div class="code">router.get('/config', facebookController.getAppConfig);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:33</p>
        <div class="code">router.post('/send-message', facebookController.sendMessage);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\integrations\routes\facebookRoutes.ts:36</p>
        <div class="code">router.post('/test', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.testConnection);</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\domains\integrations\services\FacebookService.ts:506</p>
        <div class="code">await this.prisma.message.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\domains\integrations\services\FacebookService.ts:535</p>
        <div class="code">await this.prisma.message.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\domains\integrations\services\FacebookService.ts:587</p>
        <div class="code">await this.prisma.integration.updateMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\integrations\services\FacebookService.ts:483</p>
        <div class="code">where: { id: conversation.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:166</p>
        <div class="code">where: { id, companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:268</p>
        <div class="code">where: { id, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:291</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:323</p>
        <div class="code">where: { id, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:332</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:390</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:488</p>
        <div class="code">where: { id: categoryId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:537</p>
        <div class="code">where: { id: categoryId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:557</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:585</p>
        <div class="code">where: { id: categoryIds[i] }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:600</p>
        <div class="code">where: { id: category.id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:632</p>
        <div class="code">where: { id: productId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:658</p>
        <div class="code">where: { id: productId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:749</p>
        <div class="code">this.prisma.product.count({ where: { ...where, isActive: true } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:767</p>
        <div class="code">where: { ...where, isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\domains\products\services\ProductService.ts:771</p>
        <div class="code">where: { ...where, isActive: true },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\upload\routes\uploadRoutes.ts:8</p>
        <div class="code">router.post('/image',</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\upload\routes\uploadRoutes.ts:14</p>
        <div class="code">router.post('/images',</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\upload\routes\uploadRoutes.ts:20</p>
        <div class="code">router.delete('/image/:filename', uploadController.deleteImage.bind(uploadController));</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\domains\upload\routes\uploadRoutes.ts:23</p>
        <div class="code">router.get('/image/:filename', uploadController.getImageInfo.bind(uploadController));</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\index.ts:68</p>
        <div class="code">await prisma.$queryRaw`SELECT 1 as connection_test`;</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\index.ts:122</p>
        <div class="code">where: { companyId }, // إضافة فلترة الشركة</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\index.ts:277</p>
        <div class="code">where: { id: conversationId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\index.ts:311</p>
        <div class="code">where: { id: conversationId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\auth.ts:59</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\comprehensiveIsolation.js:93</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\comprehensiveIsolation.js:100</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\comprehensiveIsolation.js:107</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\comprehensiveIsolation.js:114</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\dataIsolation.js:69</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\dataIsolation.js:76</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\dataIsolation.js:83</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\dataIsolation.js:90</p>
        <div class="code">where: { id: resourceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\superAdminMiddleware.js:23</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\middleware\validation.js:466</p>
        <div class="code">where: { id: req.user.companyId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:13</p>
        <div class="code">router.get('/growth', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:152</p>
        <div class="code">router.get('/company-performance', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:246</p>
        <div class="code">router.get('/revenue', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:326</p>
        <div class="code">router.get('/system-health', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:22</p>
        <div class="code">where: { createdAt: { gte: startDate } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:27</p>
        <div class="code">where: { createdAt: { gte: startDate } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:32</p>
        <div class="code">where: { createdAt: { gte: startDate } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:37</p>
        <div class="code">where: { createdAt: { gte: startDate } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:76</p>
        <div class="code">prisma.company.count({ where: { createdAt: { gte: previousStartDate, lt: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:77</p>
        <div class="code">prisma.user.count({ where: { createdAt: { gte: previousStartDate, lt: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:78</p>
        <div class="code">prisma.customer.count({ where: { createdAt: { gte: previousStartDate, lt: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:79</p>
        <div class="code">prisma.conversation.count({ where: { createdAt: { gte: previousStartDate, lt: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:80</p>
        <div class="code">prisma.message.count({ where: { createdAt: { gte: previousStartDate, lt: startDate } } })</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:84</p>
        <div class="code">prisma.company.count({ where: { createdAt: { gte: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:85</p>
        <div class="code">prisma.user.count({ where: { createdAt: { gte: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:86</p>
        <div class="code">prisma.customer.count({ where: { createdAt: { gte: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:87</p>
        <div class="code">prisma.conversation.count({ where: { createdAt: { gte: startDate } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:88</p>
        <div class="code">prisma.message.count({ where: { createdAt: { gte: startDate } } })</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:343</p>
        <div class="code">prisma.company.count({ where: { isActive: true } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:347</p>
        <div class="code">where: { createdAt: { gte: oneDayAgo } }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:352</p>
        <div class="code">where: { createdAt: { gte: oneDayAgo } }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminAnalyticsRoutes.js:357</p>
        <div class="code">where: { createdAt: { gte: oneDayAgo } }</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminPlansRoutes.js:114</p>
        <div class="code">router.get('/plans', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminPlansRoutes.js:184</p>
        <div class="code">router.put('/plans/:planType', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\adminPlansRoutes.js:245</p>
        <div class="code">router.get('/plans/comparison', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminPlansRoutes.js:143</p>
        <div class="code">where: { plan: plan.planType, isActive: true }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\adminPlansRoutes.js:207</p>
        <div class="code">where: { planType },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:17</p>
        <div class="code">router.get('/capabilities', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:36</p>
        <div class="code">router.put('/capabilities', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:63</p>
        <div class="code">router.post('/test/:capabilityId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:187</p>
        <div class="code">router.get('/performance', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:219</p>
        <div class="code">router.get('/analytics', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:263</p>
        <div class="code">router.post('/test-chat', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:273</p>
        <div class="code">router.post('/chat', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiCapabilitiesRoutes.js:468</p>
        <div class="code">router.post('/reset', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:29</p>
        <div class="code">router.get('/statistics', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:60</p>
        <div class="code">router.get('/evaluation/:messageId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:100</p>
        <div class="code">router.get('/recent', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:134</p>
        <div class="code">router.get('/by-quality/:level', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:179</p>
        <div class="code">router.get('/problematic', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:213</p>
        <div class="code">router.get('/trends', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:246</p>
        <div class="code">router.get('/system-status', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:278</p>
        <div class="code">router.post('/settings', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:321</p>
        <div class="code">router.get('/metrics-summary', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:379</p>
        <div class="code">router.get('/sentiment-analysis', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\aiQualityRoutes.js:414</p>
        <div class="code">router.post('/analyze-sentiment', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:24</p>
        <div class="code">router.post('/register', authRateLimiter, register);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:25</p>
        <div class="code">router.post('/login', authRateLimiter, login);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:26</p>
        <div class="code">router.post('/refresh', refreshToken);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:27</p>
        <div class="code">router.post('/forgot-password', passwordResetRateLimiter, forgotPassword);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:28</p>
        <div class="code">router.post('/reset-password', passwordResetRateLimiter, resetPassword);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:33</p>
        <div class="code">router.post('/logout', logout);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:34</p>
        <div class="code">router.get('/me', getCurrentUser);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\authRoutes.ts:35</p>
        <div class="code">router.post('/change-password', changePassword);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:14</p>
        <div class="code">router.get('/status', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:41</p>
        <div class="code">router.post('/start', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:64</p>
        <div class="code">router.post('/stop', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:87</p>
        <div class="code">router.post('/detect-now', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:122</p>
        <div class="code">router.put('/interval', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:154</p>
        <div class="code">router.post('/companies', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:187</p>
        <div class="code">router.delete('/companies/:companyId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:212</p>
        <div class="code">router.get('/history', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\autoPatternRoutes.js:240</p>
        <div class="code">router.get('/health', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:295</p>
        <div class="code">router.post('/campaigns', broadcastController.createCampaign);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:296</p>
        <div class="code">router.get('/campaigns', broadcastController.getCampaigns);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:297</p>
        <div class="code">router.get('/campaigns/:id', broadcastController.getCampaign);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:298</p>
        <div class="code">router.post('/campaigns/:id/send', broadcastController.sendCampaign);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:301</p>
        <div class="code">router.get('/analytics', broadcastController.getAnalytics);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:304</p>
        <div class="code">router.get('/customer-lists', broadcastController.getCustomerLists);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:307</p>
        <div class="code">router.get('/settings', broadcastController.getSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\broadcastRoutes.js:308</p>
        <div class="code">router.put('/settings', broadcastController.updateSettings);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:17</p>
        <div class="code">router.get('/', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:116</p>
        <div class="code">router.get('/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:174</p>
        <div class="code">router.get('/plans', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:259</p>
        <div class="code">router.get('/:id/usage', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:121</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:265</p>
        <div class="code">where: { id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:289</p>
        <div class="code">prisma.user.count({ where: { companyId: id, isActive: true } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:290</p>
        <div class="code">prisma.customer.count({ where: { companyId: id } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\companiesRoutes.ts:291</p>
        <div class="code">prisma.product.count({ where: { companyId: id, isActive: true } }),</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:479</p>
        <div class="code">await enhancedOrderService.prisma.orderItem.deleteMany({</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:199</p>
        <div class="code">companyId: 'cmdt8nrjq003vufuss47dqc45'</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:209</p>
        <div class="code">companyId: 'cmdt8nrjq003vufuss47dqc45', // Company ID الافتراضي</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:26</p>
        <div class="code">router.get('/', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:139</p>
        <div class="code">router.post('/migrate-from-files', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:280</p>
        <div class="code">router.get('/stats', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:311</p>
        <div class="code">router.get('/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:359</p>
        <div class="code">router.post('/', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:472</p>
        <div class="code">router.delete('/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:514</p>
        <div class="code">router.get('/conversations/stats', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:545</p>
        <div class="code">router.get('/conversations', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:588</p>
        <div class="code">router.get('/compare/systems', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:629</p>
        <div class="code">router.get('/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:173</p>
        <div class="code">where: { orderNumber: orderData.orderNumber }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:317</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:400</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:442</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\enhancedOrders.js:490</p>
        <div class="code">where: { id }</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:116</p>
        <div class="code">router.get('/auth/status', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:131</p>
        <div class="code">router.get('/users', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:145</p>
        <div class="code">router.get('/companies', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:246</p>
        <div class="code">router.get('/companies/plans', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:296</p>
        <div class="code">router.get('/companies/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:374</p>
        <div class="code">router.get('/customers', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:430</p>
        <div class="code">router.get('/conversations', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:512</p>
        <div class="code">router.get('/products', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:527</p>
        <div class="code">router.get('/orders', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:542</p>
        <div class="code">router.get('/reports', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\index.ts:556</p>
        <div class="code">router.get('/notifications', (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\index.ts:322</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\index.ts:392</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\index.ts:448</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:15</p>
        <div class="code">router.post('/intelligent-response', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:23</p>
        <div class="code">router.get('/intelligent-analytics', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:31</p>
        <div class="code">router.get('/conversation-memory/:customerId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:39</p>
        <div class="code">router.post('/cleanup-memory', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:47</p>
        <div class="code">router.post('/test-intelligent', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\intelligentChatRoutes.js:55</p>
        <div class="code">router.get('/intelligent-info', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:24</p>
        <div class="code">router.get('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:168</p>
        <div class="code">router.get('/:id', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:212</p>
        <div class="code">router.post('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:307</p>
        <div class="code">router.put('/:id/status', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:364</p>
        <div class="code">router.post('/:id/send', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:422</p>
        <div class="code">router.get('/stats/overview', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:128</p>
        <div class="code">where: { status: 'PAID' },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:173</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:228</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:328</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:369</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:385</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:438</p>
        <div class="code">prisma.invoice.count({ where: { status: 'PAID' } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:439</p>
        <div class="code">prisma.invoice.count({ where: { status: 'OVERDUE' } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\invoiceRoutes.js:441</p>
        <div class="code">where: { status: 'PAID' },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:24</p>
        <div class="code">router.get('/stats', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:56</p>
        <div class="code">router.get('/health', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:93</p>
        <div class="code">router.get('/errors', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:140</p>
        <div class="code">router.post('/reset', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:175</p>
        <div class="code">router.get('/performance', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:222</p>
        <div class="code">router.get('/alerts', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:254</p>
        <div class="code">router.get('/alerts/history', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:290</p>
        <div class="code">router.post('/alerts/check', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:328</p>
        <div class="code">router.post('/alerts/:alertId/resolve', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:368</p>
        <div class="code">router.put('/alerts/thresholds', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:403</p>
        <div class="code">router.post('/test-response', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:441</p>
        <div class="code">router.get('/charts', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:487</p>
        <div class="code">router.get('/charts/summary', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:516</p>
        <div class="code">router.post('/charts/save', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:547</p>
        <div class="code">router.get('/alerts/settings', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:576</p>
        <div class="code">router.put('/alerts/settings', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:611</p>
        <div class="code">router.post('/alerts/test-email', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:662</p>
        <div class="code">router.delete('/alerts/suppressed', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:696</p>
        <div class="code">router.get('/reports/daily', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:727</p>
        <div class="code">router.get('/reports/weekly', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:758</p>
        <div class="code">router.get('/reports/summary', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:795</p>
        <div class="code">router.post('/reports/export', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:847</p>
        <div class="code">router.post('/quality/rating', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:905</p>
        <div class="code">router.get('/quality/stats', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:932</p>
        <div class="code">router.get('/quality/performance', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:961</p>
        <div class="code">router.get('/quality/insights', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\monitoringRoutes.js:990</p>
        <div class="code">router.post('/quality/response', (req, res) => {</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\notifications.js:104</p>
        <div class="code">await prisma.notification.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\notifications.js:141</p>
        <div class="code">await prisma.notification.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\notifications.js:179</p>
        <div class="code">await prisma.notification.deleteMany({</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:37</p>
        <div class="code">router.get('/recent', optionalAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:98</p>
        <div class="code">router.post('/:notificationId/read', requireAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:136</p>
        <div class="code">router.post('/mark-all-read', requireAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:173</p>
        <div class="code">router.delete('/:notificationId', requireAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:207</p>
        <div class="code">router.post('/create', requireAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\notifications.js:248</p>
        <div class="code">router.get('/stats', requireAuth, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:10</p>
        <div class="code">router.get('/simple', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:31</p>
        <div class="code">router.get('/simple/stats', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:51</p>
        <div class="code">router.post('/simple/:orderNumber/status', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:82</p>
        <div class="code">router.get('/', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:158</p>
        <div class="code">router.get('/:orderNumber', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:226</p>
        <div class="code">router.post('/:orderNumber/confirm', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:250</p>
        <div class="code">router.post('/:orderNumber/cancel', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:274</p>
        <div class="code">router.get('/stats/summary', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:303</p>
        <div class="code">router.get('/customer/:customerId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:326</p>
        <div class="code">router.post('/create-simple', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\orders.js:363</p>
        <div class="code">router.post('/create', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:24</p>
        <div class="code">router.get('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:157</p>
        <div class="code">router.get('/:id', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:202</p>
        <div class="code">router.post('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:162</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:218</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:232</p>
        <div class="code">where: { id: invoiceId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\paymentRoutes.js:280</p>
        <div class="code">where: { id: invoiceId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:18</p>
        <div class="code">router.get('/:companyId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:63</p>
        <div class="code">router.put('/:companyId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:148</p>
        <div class="code">router.post('/:companyId/test-conflict', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:192</p>
        <div class="code">router.get('/:companyId/conflict-reports', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:246</p>
        <div class="code">router.put('/:companyId/conflict-reports/:reportId/resolve', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:25</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\prioritySettingsRoutes.js:106</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:400</p>
        <div class="code">await prisma.product.updateMany({</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:27</p>
        <div class="code">companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:205</p>
        <div class="code">const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:252</p>
        <div class="code">const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:304</p>
        <div class="code">const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:466</p>
        <div class="code">const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:988</p>
        <div class="code">router.get('/categories', productController.getCategories);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:989</p>
        <div class="code">router.post('/categories', productController.createCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:990</p>
        <div class="code">router.post('/categories/cleanup', productController.cleanupCategories);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:991</p>
        <div class="code">router.put('/categories/:id', productController.updateCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:992</p>
        <div class="code">router.delete('/categories/:id', productController.deleteCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:993</p>
        <div class="code">router.get('/', productController.getProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:994</p>
        <div class="code">router.post('/', productController.createProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:997</p>
        <div class="code">router.get('/:id/variants', productController.getProductVariants);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:998</p>
        <div class="code">router.post('/:id/variants', productController.createProductVariant);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1000</p>
        <div class="code">router.put('/variants/:variantId', productController.updateProductVariant); // Support both PATCH and PUT</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1002</p>
        <div class="code">router.put('/:id/variants/:variantId', productController.updateProductVariant); // Alternative path with PUT</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1003</p>
        <div class="code">router.delete('/variants/:variantId', productController.deleteProductVariant);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1008</p>
        <div class="code">router.post('/:id/images', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1116</p>
        <div class="code">router.post('/:id/variants/:variantId/images', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1216</p>
        <div class="code">router.delete('/:id/images', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1324</p>
        <div class="code">router.post('/:id/images/url', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1436</p>
        <div class="code">router.get('/:id', productController.getProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1443</p>
        <div class="code">router.delete('/:id', productController.deleteProduct);</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:68</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:141</p>
        <div class="code">where: { id: productId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:212</p>
        <div class="code">where: { companyId: user.companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:327</p>
        <div class="code">where: { id: id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:412</p>
        <div class="code">where: { id: duplicate.id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:503</p>
        <div class="code">where: { id: id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:581</p>
        <div class="code">const skuExists = await prisma.product.findUnique({ where: { sku } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:664</p>
        <div class="code">where: { id: updateData.category }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:687</p>
        <div class="code">where: { id: productId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:733</p>
        <div class="code">where: { id: productId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:775</p>
        <div class="code">where: { productId: productId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:810</p>
        <div class="code">const variantSkuExists = await prisma.productVariant.findUnique({ where: { sku: variantSku } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:914</p>
        <div class="code">where: { id: variantId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:956</p>
        <div class="code">where: { id: variantId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1039</p>
        <div class="code">where: { id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1073</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1147</p>
        <div class="code">where: { id: variantId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1182</p>
        <div class="code">where: { id: variantId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1237</p>
        <div class="code">where: { id: id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1281</p>
        <div class="code">where: { id: id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1358</p>
        <div class="code">where: { id: id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\productRoutes.js:1393</p>
        <div class="code">where: { id: id },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:14</p>
        <div class="code">router.get('/', productController.getProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:15</p>
        <div class="code">router.get('/categories', productController.getCategories);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:18</p>
        <div class="code">router.post('/', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), upload.array('images', 5), productController.createProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:19</p>
        <div class="code">router.post('/categories', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.createCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:20</p>
        <div class="code">router.post('/categories/cleanup', requireRole(UserRole.COMPANY_ADMIN), productController.cleanupCategories);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:21</p>
        <div class="code">router.put('/categories/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:22</p>
        <div class="code">router.delete('/categories/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.deleteCategory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:23</p>
        <div class="code">router.put('/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:24</p>
        <div class="code">router.delete('/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.deleteProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:27</p>
        <div class="code">router.get('/:id', productController.getProduct);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:28</p>
        <div class="code">router.put('/inventory/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateInventory);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:29</p>
        <div class="code">router.get('/low-stock', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.getLowStockProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:30</p>
        <div class="code">router.get('/analytics', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.getProductAnalytics);</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\productRoutes.ts:31</p>
        <div class="code">router.get('/export', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.exportProducts);</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:22</p>
        <div class="code">companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:34</p>
        <div class="code">router.get('/company', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:114</p>
        <div class="code">router.put('/company', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:181</p>
        <div class="code">router.get('/currencies', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:216</p>
        <div class="code">router.get('/ai', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:321</p>
        <div class="code">router.put('/ai', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:42</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:126</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:150</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:245</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\settingsRoutes.js:349</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:13</p>
        <div class="code">router.get('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:148</p>
        <div class="code">router.get('/:id', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:197</p>
        <div class="code">router.post('/', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:286</p>
        <div class="code">router.put('/:id', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:365</p>
        <div class="code">router.post('/:id/renew', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:514</p>
        <div class="code">router.post('/:id/cancel', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:585</p>
        <div class="code">router.post('/:id/renew', authenticateToken, requireSuperAdmin, async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:108</p>
        <div class="code">where: { status: 'ACTIVE' },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:153</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:212</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:261</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:300</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:318</p>
        <div class="code">where: { id: existingSubscription.companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:331</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:376</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:436</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:520</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:551</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:591</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\subscriptionRoutes.js:614</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1175</p>
        <div class="code">const enabledPatterns = await prisma.successPattern.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1245</p>
        <div class="code">const disabledPatterns = await prisma.successPattern.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1262</p>
        <div class="code">await prisma.successPattern.updateMany({</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:28</p>
        <div class="code">router.get('/analyze-patterns', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:99</p>
        <div class="code">router.get('/detect-patterns', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:147</p>
        <div class="code">router.post('/record-outcome', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:183</p>
        <div class="code">router.get('/patterns', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:274</p>
        <div class="code">router.put('/patterns/:id/approve', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:310</p>
        <div class="code">router.put('/patterns/:id/reject', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:344</p>
        <div class="code">router.put('/patterns/:id/unapprove', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:407</p>
        <div class="code">router.get('/outcome-stats', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:484</p>
        <div class="code">router.get('/response-effectiveness', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:549</p>
        <div class="code">router.post('/run-analysis', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:599</p>
        <div class="code">router.get('/export', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:664</p>
        <div class="code">router.get('/pattern-performance', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:731</p>
        <div class="code">router.get('/pattern-usage', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:826</p>
        <div class="code">router.post('/test-pattern', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:911</p>
        <div class="code">router.post('/analyze-patterns', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:947</p>
        <div class="code">router.post('/patterns/:patternId/approve', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:982</p>
        <div class="code">router.post('/cleanup-patterns/:companyId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1036</p>
        <div class="code">router.get('/cleanup-stats/:companyId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1080</p>
        <div class="code">router.get('/maintenance/status', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1103</p>
        <div class="code">router.post('/maintenance/run', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1131</p>
        <div class="code">router.post('/maintenance/start', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1160</p>
        <div class="code">router.post('/system/enable', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1228</p>
        <div class="code">router.post('/system/disable', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1320</p>
        <div class="code">router.get('/system/status', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1397</p>
        <div class="code">router.post('/cleanup-patterns', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:280</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:315</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:351</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:371</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:680</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:856</p>
        <div class="code">where: { id: patternId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:955</p>
        <div class="code">where: { id: patternId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1193</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1246</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1284</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1336</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1349</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1416</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\successLearning.js:1447</p>
        <div class="code">where: { id: pattern.id }</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\uploadRoutes.js:58</p>
        <div class="code">router.post('/single', upload.single('image'), (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\uploadRoutes.js:91</p>
        <div class="code">router.post('/multiple', upload.array('images', 10), (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\uploadRoutes.js:127</p>
        <div class="code">router.delete('/file/:filename', (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\uploadRoutes.js:201</p>
        <div class="code">router.post('/conversation-image', conversationUpload.single('image'), (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:40</p>
        <div class="code">router.get('/wallet-numbers', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:61</p>
        <div class="code">router.get('/invoice/:invoiceId', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:111</p>
        <div class="code">router.post('/submit-receipt', upload.single('receipt'), async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:180</p>
        <div class="code">router.get('/admin/wallet-numbers', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:200</p>
        <div class="code">router.post('/admin/wallet-numbers', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:229</p>
        <div class="code">router.put('/admin/wallet-numbers/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:260</p>
        <div class="code">router.delete('/admin/wallet-numbers/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:282</p>
        <div class="code">router.get('/admin/pending-receipts', async (req, res) => {</div>
    </div>
    
    <div class="issue warning">
        <h3>API route potentially missing isolation middleware</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:331</p>
        <div class="code">router.post('/admin/review-receipt/:id', async (req, res) => {</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:43</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:66</p>
        <div class="code">where: { id: invoiceId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:124</p>
        <div class="code">where: { id: invoiceId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:143</p>
        <div class="code">where: { id: walletNumberId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:235</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:265</p>
        <div class="code">where: { id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:288</p>
        <div class="code">where: { status: 'PENDING' },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:308</p>
        <div class="code">where: { status: 'PENDING' }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:337</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:359</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\routes\walletPayment.js:371</p>
        <div class="code">where: { id: receipt.invoiceId },</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\scripts\migrateOrders.js:57</p>
        <div class="code">companyId: 'cmdt8nrjq003vufuss47dqc45' // Company ID الافتراضي</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\scripts\migrateOrders.js:31</p>
        <div class="code">where: { orderNumber: orderData.orderNumber }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedProductService.js:66</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedProductService.js:127</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedProductService.js:138</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedProductService.js:210</p>
        <div class="code">where: { id: customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:197</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:212</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:334</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:345</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:364</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\advancedPromptService.js:370</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3137</p>
        <div class="code">await prisma.gemini_keys.updateMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:773</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:795</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:2475</p>
        <div class="code">where: { id: productId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:2994</p>
        <div class="code">const keyRecord = await prisma.geminiKey.findUnique({ where: { id: keyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3050</p>
        <div class="code">where: { companyId: targetCompanyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3103</p>
        <div class="code">const keyRecord = await prisma.geminiKey.findUnique({ where: { id: keyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3128</p>
        <div class="code">where: { id: keyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3186</p>
        <div class="code">const company = await prisma.company.findUnique({ where: { id: companyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3205</p>
        <div class="code">where: { companyId: company.id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3389</p>
        <div class="code">where: { id: learningData.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:3998</p>
        <div class="code">const company = await prisma.company.findUnique({ where: { id: companyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:4005</p>
        <div class="code">where: { companyId: company.id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:4011</p>
        <div class="code">where: { companyId: company.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:4057</p>
        <div class="code">const company = await prisma.company.findUnique({ where: { id: companyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiAgentService.js:4066</p>
        <div class="code">where: { companyId: company.id }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\aiQualityEvaluator.js:41</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\analyticsService.js:676</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:39</p>
        <div class="code">where: { email: data.email },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:136</p>
        <div class="code">where: { email: credentials.email },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:169</p>
        <div class="code">where: { id: user.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:208</p>
        <div class="code">where: { id: decoded.userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:239</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:275</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:294</p>
        <div class="code">where: { id: userId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:309</p>
        <div class="code">where: { email },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:324</p>
        <div class="code">where: { id: user.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\authService.ts:359</p>
        <div class="code">where: { id: user.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\autoPatternDetectionService.js:149</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\billingNotificationService.js:237</p>
        <div class="code">await prisma.invoice.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\billingNotificationService.js:340</p>
        <div class="code">await prisma.subscription.updateMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\continuousLearningServiceV2.js:330</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\services\conversationAnalysisService.js:274</p>
        <div class="code">companyId: 'cmdt8nrjq003vufuss47dqc45'</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:82</p>
        <div class="code">where: { id: data.customerId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:89</p>
        <div class="code">where: { facebookId: data.customerId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:168</p>
        <div class="code">where: { id: conversationId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:388</p>
        <div class="code">where: { id: order.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:536</p>
        <div class="code">where: { id: conversationId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:576</p>
        <div class="code">where: { id: conversationId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:827</p>
        <div class="code">where: { ...where, confidence: { not: null } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:848</p>
        <div class="code">where: { ...where, city: { not: null } },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\enhancedOrderService.js:1018</p>
        <div class="code">where: { id: orderId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\inventoryService.js:666</p>
        <div class="code">await prisma.stockAlert.deleteMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\inventoryService.js:219</p>
        <div class="code">where: { productId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\memoryService.js:347</p>
        <div class="code">const deletedMemoryCount = await prisma.conversationMemory.deleteMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\memoryService.js:453</p>
        <div class="code">const deletedMemoryCount = await prisma.conversationMemory.deleteMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\memoryService.js:670</p>
        <div class="code">const updatedRecords = await prisma.conversationMemory.updateMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\multimodalService.js:59</p>
        <div class="code">where: { isActive: true }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\multimodalService.js:104</p>
        <div class="code">where: { isActive: true }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:64</p>
        <div class="code">where: { id: order.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:149</p>
        <div class="code">where: { id: customerId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:154</p>
        <div class="code">where: { id: customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:172</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:195</p>
        <div class="code">where: { orderNumber },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:217</p>
        <div class="code">where: { orderNumber },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:241</p>
        <div class="code">where: { orderNumber },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:269</p>
        <div class="code">where: { orderNumber },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\orderService.js:279</p>
        <div class="code">where: { id: order.customerId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\outcomeTracker.js:98</p>
        <div class="code">where: { conversationId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\outcomeTracker.js:350</p>
        <div class="code">where: { id: existing.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\outcomeTracker.js:395</p>
        <div class="code">where: { id: conversationId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:289</p>
        <div class="code">await this.prisma.patternPerformance.updateMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:319</p>
        <div class="code">where: { id: patternId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:358</p>
        <div class="code">where: { patternId, companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:381</p>
        <div class="code">where: { id: performance.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:664</p>
        <div class="code">where: { id: patternId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternApplicationService.js:690</p>
        <div class="code">where: { id: patternId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\patternCleanupService.js:145</p>
        <div class="code">await this.prisma.successPattern.deleteMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternCleanupService.js:44</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternCleanupService.js:126</p>
        <div class="code">where: { id: bestPattern.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternCleanupService.js:247</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue critical">
        <h3>Raw SQL query without company isolation</h3>
        <p><strong>File:</strong> src\services\patternDetector.js:196</p>
        <div class="code">await this.prisma.$queryRaw`SELECT 1 as connection_test`;</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternDetector.js:142</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternDetector.js:958</p>
        <div class="code">where: { id: existingPatternId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternDetector.js:962</p>
        <div class="code">where: { id: existingPatternId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\patternDetector.js:1035</p>
        <div class="code">where: { id: companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\planLimitsService.js:51</p>
        <div class="code">where: { id: companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productSearchService.js:207</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productSearchService.js:459</p>
        <div class="code">this.prisma.product.count({ where: { companyId } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productSearchService.js:460</p>
        <div class="code">this.prisma.product.count({ where: { companyId, isActive: true } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productSearchService.js:461</p>
        <div class="code">this.prisma.product.count({ where: { companyId, isActive: true, stock: { lte: 0 } } }),</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productSearchService.js:462</p>
        <div class="code">this.prisma.category.count({ where: { companyId } })</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productsPromptBuilder.js:50</p>
        <div class="code">where: { companyId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\productsPromptBuilder.js:54</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\promptEnhancementService.js:160</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\ragService.js:49</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\ragService.js:151</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\ragService.js:326</p>
        <div class="code">// const faqs = await prisma.faq.findMany({ where: { companyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\ragService.js:364</p>
        <div class="code">// const policies = await prisma.policy.findMany({ where: { companyId } });</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\ragService.js:763</p>
        <div class="code">where: { customerId },</div>
    </div>
    
    <div class="issue warning">
        <h3>Hardcoded company ID found</h3>
        <p><strong>File:</strong> src\services\responseOptimizationService.js:596</p>
        <div class="code">companyId: 'cmdt8nrjq003vufuss47dqc45'</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\responseOptimizer.js:488</p>
        <div class="code">where: { companyId }</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:200</p>
        <div class="code">await this.prisma.successPattern.updateMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:268</p>
        <div class="code">await this.prisma.successPattern.deleteMany({</div>
    </div>
    
    <div class="issue critical">
        <h3>Bulk operation without proper filtering</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:346</p>
        <div class="code">const deletedUsage = await this.prisma.patternUsage.deleteMany({</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:71</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:147</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:293</p>
        <div class="code">where: { isActive: true },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\scheduledPatternMaintenanceService.js:315</p>
        <div class="code">where: { id: pattern.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\subscriptionRenewalService.js:81</p>
        <div class="code">where: { id: subscription.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\subscriptionRenewalService.js:242</p>
        <div class="code">where: { id: subscription.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\subscriptionRenewalService.js:257</p>
        <div class="code">where: { id: subscription.id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\services\subscriptionRenewalService.js:311</p>
        <div class="code">where: { id: subscriptionId },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:44</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:141</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:166</p>
        <div class="code">where: { id },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:197</p>
        <div class="code">where: { [field]: value },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:214</p>
        <div class="code">where: { [field]: value },</div>
    </div>
    
    <div class="issue info">
        <h3>Where clause potentially missing companyId</h3>
        <p><strong>File:</strong> src\shared\base\BaseRepository.ts:260</p>
        <div class="code">where: { id },</div>
    </div>
    
    
    <h2>📋 Recommendations</h2>
    <ul>
        <li>Add companyId filter to all Prisma queries</li>
        <li>Use middleware for company isolation in all API routes</li>
        <li>Avoid using findMany() without filtering</li>
        <li>Use req.user.companyId from authentication context</li>
        <li>Avoid hardcoding company IDs in code</li>
    </ul>
</body>
</html>
