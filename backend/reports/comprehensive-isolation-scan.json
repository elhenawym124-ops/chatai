{
  "timestamp": "2025-08-17T09:41:45.942Z",
  "summary": {
    "filesScanned": 179,
    "criticalIssues": 5,
    "warningIssues": 424,
    "suspiciousPatterns": 64,
    "goodPractices": 270,
    "totalIssues": 429
  },
  "details": {
    "criticalIssues": [
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 62,
        "content": "const products = await prisma.product.findMany({",
        "description": "عمليات bulk بدون فحص companyId",
        "severity": "CRITICAL",
        "match": "await prisma.product.findMany({\n        where: whereClause,\n        include: {\n          category: t"
      },
      {
        "file": "src\\services\\inventoryService.js",
        "line": 219,
        "content": "const inventory = await prisma.inventory.findMany({",
        "description": "عمليات bulk بدون فحص companyId",
        "severity": "CRITICAL",
        "match": "await prisma.inventory.findMany({\n        where: { productId }"
      },
      {
        "file": "src\\services\\orderService.js",
        "line": 171,
        "content": "const orders = await prisma.order.findMany({",
        "description": "عمليات bulk بدون فحص companyId",
        "severity": "CRITICAL",
        "match": "await prisma.order.findMany({\n        where: { customerId }"
      },
      {
        "file": "src\\services\\ragService.js",
        "line": 763,
        "content": "const orders = await prisma.order.findMany({",
        "description": "عمليات bulk بدون فحص companyId",
        "severity": "CRITICAL",
        "match": "await prisma.order.findMany({\n        where: { customerId }"
      },
      {
        "file": "src\\services\\subscriptionRenewalService.js",
        "line": 28,
        "content": "const subscriptionsDue = await prisma.subscription.findMany({",
        "description": "عمليات bulk بدون فحص companyId",
        "severity": "CRITICAL",
        "match": "await prisma.subscription.findMany({\n        where: {\n          status: 'ACTIVE',\n          autoRene"
      }
    ],
    "warningIssues": [
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 22,
        "content": "const { companyId } = req.user || { companyId: 'cmdkj6coz0000uf0cyscco6lr' };",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdkj6coz0000uf0cyscco6lr'"
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 19,
        "content": "router.post('/generate-response', aiController.generateResponse);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/generate-response', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 22,
        "content": "router.post('/analyze-sentiment', aiController.analyzeSentiment);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/analyze-sentiment', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 23,
        "content": "router.post('/recommend-products', aiController.recommendProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/recommend-products', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 24,
        "content": "router.get('/insights/:conversationId', aiController.getConversationInsights);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/insights/:conversationId', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 27,
        "content": "router.get('/analytics', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAnalytics);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 30,
        "content": "router.get('/settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/settings', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 31,
        "content": "router.put('/settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/settings', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 34,
        "content": "router.post('/test', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.testResponse);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 39,
        "content": "router.get('/models', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAvailableModels);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/models', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 40,
        "content": "router.get('/usage-stats', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getUsageStats);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/usage-stats', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 43,
        "content": "router.post('/generate-advanced-response', aiController.generateAdvancedResponse);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/generate-advanced-response', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 48,
        "content": "router.get('/prompt-templates', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getPromptTemplates);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/prompt-templates', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 51,
        "content": "router.get('/prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getCompanyPrompts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/prompts', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 52,
        "content": "router.put('/prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateCompanyPrompts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/prompts', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 53,
        "content": "router.post('/prompts/apply-template', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.applyTemplate);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/prompts/apply-template', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 58,
        "content": "router.get('/static-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getStaticPrompts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/static-prompts', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 59,
        "content": "router.post('/static-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.createStaticPrompt);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/static-prompts', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 60,
        "content": "router.put('/static-prompts/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateStaticPrompt);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/static-prompts/:id', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 61,
        "content": "router.delete('/static-prompts/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.deleteStaticPrompt);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/static-prompts/:id', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 64,
        "content": "router.get('/business-templates', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getBusinessTemplates);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/business-templates', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 65,
        "content": "router.get('/business-types', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getBusinessTypes);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/business-types', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 66,
        "content": "router.post('/business-templates/apply/:templateId', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.applyBusinessTemplate);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/business-templates/apply/:templateId', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 69,
        "content": "router.get('/advanced-services/company-prompts', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAdvancedCompanyPrompts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/advanced-services/company-prompts', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 70,
        "content": "router.get('/advanced-services/active-services', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getActiveServices);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/advanced-services/active-services', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 71,
        "content": "router.get('/advanced-services/configuration', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getAdvancedConfiguration);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/advanced-services/configuration', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 72,
        "content": "router.put('/advanced-services/configuration', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateAdvancedConfiguration);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/advanced-services/configuration', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 77,
        "content": "router.get('/product-settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.getProductAiSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/product-settings', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 78,
        "content": "router.put('/product-settings', requireRole(['COMPANY_ADMIN', 'MANAGER']), aiController.updateProductAiSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/product-settings', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 81,
        "content": "router.post('/recommend-products-advanced', aiController.recommendProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/recommend-products-advanced', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 82,
        "content": "router.post('/analyze-image', aiController.analyzeCustomerImage);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/analyze-image', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 83,
        "content": "router.post('/create-order', aiController.createOrderFromConversation);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/create-order', "
      },
      {
        "file": "src\\domains\\ai\\routes\\aiRoutes.ts",
        "line": 84,
        "content": "router.get('/product-image/:productId', aiController.getProductImage);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/product-image/:productId', "
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 70,
        "content": "const activeKey = await this.prisma.geminiKey.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: { isActive: true }"
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 16,
        "content": "router.post('/register', rateLimitMiddleware.register, authController.register);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/register', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 17,
        "content": "router.post('/login', rateLimitMiddleware.login, authController.login);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/login', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 18,
        "content": "router.post('/refresh', rateLimitMiddleware.refresh, authController.refreshToken);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/refresh', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 19,
        "content": "router.post('/forgot-password', rateLimitMiddleware.forgotPassword, authController.forgotPassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/forgot-password', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 20,
        "content": "router.post('/reset-password', rateLimitMiddleware.resetPassword, authController.resetPassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/reset-password', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 21,
        "content": "router.post('/verify-email', authController.verifyEmail);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/verify-email', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 22,
        "content": "router.post('/resend-verification', rateLimitMiddleware.resendVerification, authController.resendVerification);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/resend-verification', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 27,
        "content": "router.post('/logout', authController.logout);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/logout', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 28,
        "content": "router.get('/me', authController.getProfile);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/me', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 29,
        "content": "router.put('/profile', authController.updateProfile);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/profile', "
      },
      {
        "file": "src\\domains\\auth\\routes\\authRoutes.ts",
        "line": 30,
        "content": "router.post('/change-password', authController.changePassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/change-password', "
      },
      {
        "file": "src\\domains\\auth\\services\\AuthService.ts",
        "line": 399,
        "content": "// const user = await this.prisma.user.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n      //   where: {\n      //     resetToken: token,\n      //     resetTokenExpiry: { gt:"
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 8,
        "content": "router.post('/campaigns', broadcastController.createCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 9,
        "content": "router.get('/campaigns', broadcastController.getCampaigns.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/campaigns', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 10,
        "content": "router.get('/campaigns/:id', broadcastController.getCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/campaigns/:id', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 11,
        "content": "router.put('/campaigns/:id', broadcastController.updateCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/campaigns/:id', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 12,
        "content": "router.delete('/campaigns/:id', broadcastController.cancelCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/campaigns/:id', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 13,
        "content": "router.post('/campaigns/:id/pause', broadcastController.pauseCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns/:id/pause', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 14,
        "content": "router.post('/campaigns/:id/resume', broadcastController.resumeCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns/:id/resume', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 15,
        "content": "router.post('/campaigns/:id/send', broadcastController.sendCampaign.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns/:id/send', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 18,
        "content": "router.get('/analytics', broadcastController.getAnalytics.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 19,
        "content": "router.get('/analytics/:campaignId', broadcastController.getCampaignAnalytics.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics/:campaignId', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 22,
        "content": "router.get('/customer-lists', broadcastController.getCustomerLists.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/customer-lists', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 25,
        "content": "router.get('/settings', broadcastController.getSettings.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/settings', "
      },
      {
        "file": "src\\domains\\broadcast\\routes\\broadcastRoutes.ts",
        "line": 26,
        "content": "router.put('/settings', broadcastController.updateSettings.bind(broadcastController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/settings', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 105,
        "content": "router.get('/', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 130,
        "content": "router.get('/:id', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 159,
        "content": "router.get('/:id/messages', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/messages', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 187,
        "content": "router.post('/:id/send', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/send', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 239,
        "content": "router.delete('/:id', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id', "
      },
      {
        "file": "src\\domains\\conversations\\routes\\conversationRoutes.ts",
        "line": 282,
        "content": "router.post('/', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 19,
        "content": "router.get('/search', customerController.searchCustomers);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/search', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 22,
        "content": "router.get('/segments', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.getCustomerSegments);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/segments', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 25,
        "content": "router.get('/export', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.exportCustomers);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/export', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 28,
        "content": "router.get('/', customerController.getCustomers);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 29,
        "content": "router.post('/', customerController.createCustomer);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 30,
        "content": "router.get('/:id', customerController.getCustomer);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 31,
        "content": "router.put('/:id', customerController.updateCustomer);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/:id', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 32,
        "content": "router.delete('/:id', requireRole(['COMPANY_ADMIN', 'MANAGER']), customerController.deleteCustomer);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 35,
        "content": "router.get('/:id/interactions', customerController.getCustomerInteractions);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/interactions', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 36,
        "content": "router.get('/:id/stats', customerController.getCustomerStats);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/stats', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 39,
        "content": "router.get('/:id/notes', customerController.getCustomerNotes);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/notes', "
      },
      {
        "file": "src\\domains\\customers\\routes\\customerRoutes.ts",
        "line": 40,
        "content": "router.post('/:id/notes', customerController.addCustomerNote);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/notes', "
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 514,
        "content": "this.prisma.order.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n          where: { customerId }"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 518,
        "content": "this.prisma.conversation.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n          where: {\n            participants: {\n              some: { customerId }"
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 16,
        "content": "router.get('/webhook', facebookController.verifyWebhook);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/webhook', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 17,
        "content": "router.post('/webhook', facebookController.handleWebhook);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/webhook', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 23,
        "content": "router.get('/pages', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.getPages);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/pages', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 24,
        "content": "router.post('/connect', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.connectPage);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/connect', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 25,
        "content": "router.delete('/:pageId', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.disconnectPage);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:pageId', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 28,
        "content": "router.get('/connected', facebookController.getConnectedPages);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/connected', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 29,
        "content": "router.get('/status', facebookController.getIntegrationStatus);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/status', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 30,
        "content": "router.get('/config', facebookController.getAppConfig);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/config', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 33,
        "content": "router.post('/send-message', facebookController.sendMessage);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/send-message', "
      },
      {
        "file": "src\\domains\\integrations\\routes\\facebookRoutes.ts",
        "line": 36,
        "content": "router.post('/test', requireRole(['COMPANY_ADMIN', 'MANAGER']), facebookController.testConnection);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test', "
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 346,
        "content": "let facebookPage = await this.prisma.facebookPage.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: {\n          pageId,\n          status: 'connected',\n        }"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 366,
        "content": "integration = await this.prisma.integration.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n          where: {\n            platform: 'FACEBOOK',\n            externalId: pageId,\n   "
      },
      {
        "file": "src\\domains\\upload\\routes\\uploadRoutes.ts",
        "line": 8,
        "content": "router.post('/image',",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/image', \n  "
      },
      {
        "file": "src\\domains\\upload\\routes\\uploadRoutes.ts",
        "line": 14,
        "content": "router.post('/images',",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/images', \n  "
      },
      {
        "file": "src\\domains\\upload\\routes\\uploadRoutes.ts",
        "line": 20,
        "content": "router.delete('/image/:filename', uploadController.deleteImage.bind(uploadController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/image/:filename', "
      },
      {
        "file": "src\\domains\\upload\\routes\\uploadRoutes.ts",
        "line": 23,
        "content": "router.get('/image/:filename', uploadController.getImageInfo.bind(uploadController));",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/image/:filename', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 17,
        "content": "router.get('/capabilities', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/capabilities', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 36,
        "content": "router.put('/capabilities', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/capabilities', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 63,
        "content": "router.post('/test/:capabilityId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test/:capabilityId', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 187,
        "content": "router.get('/performance', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/performance', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 219,
        "content": "router.get('/analytics', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 263,
        "content": "router.post('/test-chat', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test-chat', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 273,
        "content": "router.post('/chat', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/chat', "
      },
      {
        "file": "src\\routes\\aiCapabilitiesRoutes.js",
        "line": 468,
        "content": "router.post('/reset', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/reset', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 29,
        "content": "router.get('/statistics', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/statistics', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 60,
        "content": "router.get('/evaluation/:messageId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/evaluation/:messageId', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 100,
        "content": "router.get('/recent', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/recent', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 134,
        "content": "router.get('/by-quality/:level', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/by-quality/:level', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 179,
        "content": "router.get('/problematic', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/problematic', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 213,
        "content": "router.get('/trends', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/trends', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 246,
        "content": "router.get('/system-status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/system-status', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 278,
        "content": "router.post('/settings', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/settings', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 321,
        "content": "router.get('/metrics-summary', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/metrics-summary', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 379,
        "content": "router.get('/sentiment-analysis', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/sentiment-analysis', "
      },
      {
        "file": "src\\routes\\aiQualityRoutes.js",
        "line": 414,
        "content": "router.post('/analyze-sentiment', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/analyze-sentiment', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 24,
        "content": "router.post('/register', authRateLimiter, register);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/register', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 25,
        "content": "router.post('/login', authRateLimiter, login);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/login', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 26,
        "content": "router.post('/refresh', refreshToken);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/refresh', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 27,
        "content": "router.post('/forgot-password', passwordResetRateLimiter, forgotPassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/forgot-password', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 28,
        "content": "router.post('/reset-password', passwordResetRateLimiter, resetPassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/reset-password', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 33,
        "content": "router.post('/logout', logout);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/logout', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 34,
        "content": "router.get('/me', getCurrentUser);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/me', "
      },
      {
        "file": "src\\routes\\authRoutes.ts",
        "line": 35,
        "content": "router.post('/change-password', changePassword);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/change-password', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 14,
        "content": "router.get('/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/status', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 41,
        "content": "router.post('/start', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/start', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 64,
        "content": "router.post('/stop', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/stop', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 87,
        "content": "router.post('/detect-now', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/detect-now', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 122,
        "content": "router.put('/interval', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/interval', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 154,
        "content": "router.post('/companies', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/companies', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 187,
        "content": "router.delete('/companies/:companyId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/companies/:companyId', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 212,
        "content": "router.get('/history', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/history', "
      },
      {
        "file": "src\\routes\\autoPatternRoutes.js",
        "line": 240,
        "content": "router.get('/health', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/health', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 295,
        "content": "router.post('/campaigns', broadcastController.createCampaign);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 296,
        "content": "router.get('/campaigns', broadcastController.getCampaigns);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/campaigns', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 297,
        "content": "router.get('/campaigns/:id', broadcastController.getCampaign);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/campaigns/:id', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 298,
        "content": "router.post('/campaigns/:id/send', broadcastController.sendCampaign);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/campaigns/:id/send', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 301,
        "content": "router.get('/analytics', broadcastController.getAnalytics);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 304,
        "content": "router.get('/customer-lists', broadcastController.getCustomerLists);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/customer-lists', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 307,
        "content": "router.get('/settings', broadcastController.getSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/settings', "
      },
      {
        "file": "src\\routes\\broadcastRoutes.js",
        "line": 308,
        "content": "router.put('/settings', broadcastController.updateSettings);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/settings', "
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 17,
        "content": "router.get('/', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 116,
        "content": "router.get('/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 174,
        "content": "router.get('/plans', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/plans', "
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 259,
        "content": "router.get('/:id/usage', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/usage', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 26,
        "content": "router.get('/', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 139,
        "content": "router.post('/migrate-from-files', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/migrate-from-files', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 280,
        "content": "router.get('/stats', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/stats', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 311,
        "content": "router.get('/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 359,
        "content": "router.post('/', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 393,
        "content": "router.patch('/:id/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/:id/status', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 435,
        "content": "router.patch('/:id/validation', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/:id/validation', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 472,
        "content": "router.delete('/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 514,
        "content": "router.get('/conversations/stats', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/conversations/stats', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 545,
        "content": "router.get('/conversations', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/conversations', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 588,
        "content": "router.get('/compare/systems', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/compare/systems', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 629,
        "content": "router.get('/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 199,
        "content": "companyId: 'cmdt8nrjq003vufuss47dqc45'",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdt8nrjq003vufuss47dqc45'"
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 209,
        "content": "companyId: 'cmdt8nrjq003vufuss47dqc45', // Company ID الافتراضي",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdt8nrjq003vufuss47dqc45'"
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 183,
        "content": "let customer = await prisma.customer.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n                    where: {\n                        OR: [\n                            {"
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 116,
        "content": "router.get('/auth/status', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/auth/status', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 131,
        "content": "router.get('/users', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/users', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 145,
        "content": "router.get('/companies', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/companies', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 246,
        "content": "router.get('/companies/plans', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/companies/plans', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 296,
        "content": "router.get('/companies/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/companies/:id', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 374,
        "content": "router.get('/customers', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/customers', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 430,
        "content": "router.get('/conversations', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/conversations', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 512,
        "content": "router.get('/products', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/products', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 527,
        "content": "router.get('/orders', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/orders', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 542,
        "content": "router.get('/reports', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/reports', "
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 556,
        "content": "router.get('/notifications', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/notifications', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 15,
        "content": "router.post('/intelligent-response', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/intelligent-response', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 23,
        "content": "router.get('/intelligent-analytics', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/intelligent-analytics', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 31,
        "content": "router.get('/conversation-memory/:customerId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/conversation-memory/:customerId', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 39,
        "content": "router.post('/cleanup-memory', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/cleanup-memory', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 47,
        "content": "router.post('/test-intelligent', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test-intelligent', "
      },
      {
        "file": "src\\routes\\intelligentChatRoutes.js",
        "line": 55,
        "content": "router.get('/intelligent-info', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/intelligent-info', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 24,
        "content": "router.get('/stats', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/stats', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 56,
        "content": "router.get('/health', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/health', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 93,
        "content": "router.get('/errors', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/errors', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 140,
        "content": "router.post('/reset', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/reset', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 175,
        "content": "router.get('/performance', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/performance', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 222,
        "content": "router.get('/alerts', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/alerts', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 254,
        "content": "router.get('/alerts/history', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/alerts/history', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 290,
        "content": "router.post('/alerts/check', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/alerts/check', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 328,
        "content": "router.post('/alerts/:alertId/resolve', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/alerts/:alertId/resolve', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 368,
        "content": "router.put('/alerts/thresholds', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/alerts/thresholds', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 403,
        "content": "router.post('/test-response', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test-response', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 441,
        "content": "router.get('/charts', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/charts', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 487,
        "content": "router.get('/charts/summary', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/charts/summary', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 516,
        "content": "router.post('/charts/save', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/charts/save', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 547,
        "content": "router.get('/alerts/settings', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/alerts/settings', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 576,
        "content": "router.put('/alerts/settings', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/alerts/settings', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 611,
        "content": "router.post('/alerts/test-email', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/alerts/test-email', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 662,
        "content": "router.delete('/alerts/suppressed', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/alerts/suppressed', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 696,
        "content": "router.get('/reports/daily', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/reports/daily', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 727,
        "content": "router.get('/reports/weekly', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/reports/weekly', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 758,
        "content": "router.get('/reports/summary', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/reports/summary', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 795,
        "content": "router.post('/reports/export', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/reports/export', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 847,
        "content": "router.post('/quality/rating', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/quality/rating', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 905,
        "content": "router.get('/quality/stats', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/quality/stats', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 932,
        "content": "router.get('/quality/performance', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/quality/performance', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 961,
        "content": "router.get('/quality/insights', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/quality/insights', "
      },
      {
        "file": "src\\routes\\monitoringRoutes.js",
        "line": 990,
        "content": "router.post('/quality/response', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/quality/response', "
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 37,
        "content": "router.get('/recent', optionalAuth, async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/recent', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 10,
        "content": "router.get('/simple', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/simple', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 31,
        "content": "router.get('/simple/stats', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/simple/stats', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 51,
        "content": "router.post('/simple/:orderNumber/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/simple/:orderNumber/status', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 82,
        "content": "router.get('/', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 158,
        "content": "router.get('/:orderNumber', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:orderNumber', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 187,
        "content": "router.patch('/:orderNumber/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/:orderNumber/status', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 226,
        "content": "router.post('/:orderNumber/confirm', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:orderNumber/confirm', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 250,
        "content": "router.post('/:orderNumber/cancel', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:orderNumber/cancel', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 274,
        "content": "router.get('/stats/summary', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/stats/summary', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 303,
        "content": "router.get('/customer/:customerId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/customer/:customerId', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 326,
        "content": "router.post('/create-simple', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/create-simple', "
      },
      {
        "file": "src\\routes\\orders.js",
        "line": 363,
        "content": "router.post('/create', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/create', "
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 18,
        "content": "router.get('/:companyId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:companyId', "
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 63,
        "content": "router.put('/:companyId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/:companyId', "
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 148,
        "content": "router.post('/:companyId/test-conflict', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:companyId/test-conflict', "
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 192,
        "content": "router.get('/:companyId/conflict-reports', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:companyId/conflict-reports', "
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 246,
        "content": "router.put('/:companyId/conflict-reports/:reportId/resolve', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/:companyId/conflict-reports/:reportId/resolve', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 989,
        "content": "router.get('/categories', productController.getCategories);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/categories', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 990,
        "content": "router.post('/categories', productController.createCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/categories', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 991,
        "content": "router.post('/categories/cleanup', productController.cleanupCategories);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/categories/cleanup', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 992,
        "content": "router.put('/categories/:id', productController.updateCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/categories/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 993,
        "content": "router.delete('/categories/:id', productController.deleteCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/categories/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 994,
        "content": "router.get('/', productController.getProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 995,
        "content": "router.post('/', productController.createProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 998,
        "content": "router.get('/:id/variants', productController.getProductVariants);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id/variants', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 999,
        "content": "router.post('/:id/variants', productController.createProductVariant);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/variants', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1000,
        "content": "router.patch('/variants/:variantId', productController.updateProductVariant);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/variants/:variantId', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1001,
        "content": "router.put('/variants/:variantId', productController.updateProductVariant); // Support both PATCH and PUT",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/variants/:variantId', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1002,
        "content": "router.patch('/:id/variants/:variantId', productController.updateProductVariant); // Alternative path",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/:id/variants/:variantId', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1003,
        "content": "router.put('/:id/variants/:variantId', productController.updateProductVariant); // Alternative path with PUT",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/:id/variants/:variantId', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1004,
        "content": "router.delete('/variants/:variantId', productController.deleteProductVariant);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/variants/:variantId', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1009,
        "content": "router.post('/:id/images', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/images', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1117,
        "content": "router.post('/:id/variants/:variantId/images', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/variants/:variantId/images', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1217,
        "content": "router.delete('/:id/images', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id/images', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1325,
        "content": "router.post('/:id/images/url', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/:id/images/url', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1437,
        "content": "router.get('/:id', productController.getProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1443,
        "content": "router.patch('/:id', productController.updateProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.patch('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1444,
        "content": "router.delete('/:id', productController.deleteProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 27,
        "content": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 205,
        "content": "const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 252,
        "content": "const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 304,
        "content": "const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 466,
        "content": "const user = req.user || { companyId: 'cmd5c0c9y0000ymzdd7wtv7ib' };",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 14,
        "content": "router.get('/', productController.getProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 15,
        "content": "router.get('/categories', productController.getCategories);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/categories', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 18,
        "content": "router.post('/', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), upload.array('images', 5), productController.createProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 19,
        "content": "router.post('/categories', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.createCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/categories', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 20,
        "content": "router.post('/categories/cleanup', requireRole(UserRole.COMPANY_ADMIN), productController.cleanupCategories);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/categories/cleanup', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 21,
        "content": "router.put('/categories/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/categories/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 22,
        "content": "router.delete('/categories/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.deleteCategory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/categories/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 23,
        "content": "router.put('/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 24,
        "content": "router.delete('/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.deleteProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 27,
        "content": "router.get('/:id', productController.getProduct);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 28,
        "content": "router.put('/inventory/:id', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.updateInventory);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/inventory/:id', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 29,
        "content": "router.get('/low-stock', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.getLowStockProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/low-stock', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 30,
        "content": "router.get('/analytics', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.getProductAnalytics);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analytics', "
      },
      {
        "file": "src\\routes\\productRoutes.ts",
        "line": 31,
        "content": "router.get('/export', requireRole(UserRole.COMPANY_ADMIN, UserRole.MANAGER), productController.exportProducts);",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/export', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 34,
        "content": "router.get('/company', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/company', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 114,
        "content": "router.put('/company', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/company', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 181,
        "content": "router.get('/currencies', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/currencies', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 216,
        "content": "router.get('/ai', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/ai', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 321,
        "content": "router.put('/ai', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/ai', "
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 22,
        "content": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmd5c0c9y0000ymzdd7wtv7ib'"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 28,
        "content": "router.get('/analyze-patterns', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/analyze-patterns', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 99,
        "content": "router.get('/detect-patterns', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/detect-patterns', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 147,
        "content": "router.post('/record-outcome', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/record-outcome', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 183,
        "content": "router.get('/patterns', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/patterns', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 274,
        "content": "router.put('/patterns/:id/approve', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/patterns/:id/approve', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 310,
        "content": "router.put('/patterns/:id/reject', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/patterns/:id/reject', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 344,
        "content": "router.put('/patterns/:id/unapprove', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/patterns/:id/unapprove', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 407,
        "content": "router.get('/outcome-stats', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/outcome-stats', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 484,
        "content": "router.get('/response-effectiveness', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/response-effectiveness', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 549,
        "content": "router.post('/run-analysis', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/run-analysis', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 599,
        "content": "router.get('/export', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/export', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 664,
        "content": "router.get('/pattern-performance', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/pattern-performance', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 731,
        "content": "router.get('/pattern-usage', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/pattern-usage', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 826,
        "content": "router.post('/test-pattern', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/test-pattern', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 911,
        "content": "router.post('/analyze-patterns', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/analyze-patterns', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 947,
        "content": "router.post('/patterns/:patternId/approve', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/patterns/:patternId/approve', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 982,
        "content": "router.post('/cleanup-patterns/:companyId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/cleanup-patterns/:companyId', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1036,
        "content": "router.get('/cleanup-stats/:companyId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/cleanup-stats/:companyId', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1080,
        "content": "router.get('/maintenance/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/maintenance/status', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1103,
        "content": "router.post('/maintenance/run', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/maintenance/run', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1131,
        "content": "router.post('/maintenance/start', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/maintenance/start', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1160,
        "content": "router.post('/system/enable', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/system/enable', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1228,
        "content": "router.post('/system/disable', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/system/disable', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1320,
        "content": "router.get('/system/status', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/system/status', "
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1397,
        "content": "router.post('/cleanup-patterns', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/cleanup-patterns', "
      },
      {
        "file": "src\\routes\\uploadRoutes.js",
        "line": 58,
        "content": "router.post('/single', upload.single('image'), (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/single', "
      },
      {
        "file": "src\\routes\\uploadRoutes.js",
        "line": 91,
        "content": "router.post('/multiple', upload.array('images', 10), (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/multiple', "
      },
      {
        "file": "src\\routes\\uploadRoutes.js",
        "line": 127,
        "content": "router.delete('/file/:filename', (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/file/:filename', "
      },
      {
        "file": "src\\routes\\uploadRoutes.js",
        "line": 201,
        "content": "router.post('/conversation-image', conversationUpload.single('image'), (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/conversation-image', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 40,
        "content": "router.get('/wallet-numbers', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/wallet-numbers', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 62,
        "content": "router.get('/invoice/:invoiceId', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/invoice/:invoiceId', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 112,
        "content": "router.post('/submit-receipt', upload.single('receipt'), async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/submit-receipt', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 181,
        "content": "router.get('/admin/wallet-numbers', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/admin/wallet-numbers', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 202,
        "content": "router.post('/admin/wallet-numbers', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/admin/wallet-numbers', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 231,
        "content": "router.put('/admin/wallet-numbers/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.put('/admin/wallet-numbers/:id', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 262,
        "content": "router.delete('/admin/wallet-numbers/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.delete('/admin/wallet-numbers/:id', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 284,
        "content": "router.get('/admin/pending-receipts', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.get('/admin/pending-receipts', "
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 335,
        "content": "router.post('/admin/review-receipt/:id', async (req, res) => {",
        "description": "API route بدون middleware عزل",
        "severity": "WARNING",
        "match": "router.post('/admin/review-receipt/:id', "
      },
      {
        "file": "src\\scripts\\migrateOrders.js",
        "line": 57,
        "content": "companyId: 'cmdt8nrjq003vufuss47dqc45' // Company ID الافتراضي",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdt8nrjq003vufuss47dqc45'"
      },
      {
        "file": "src\\scripts\\migrateOrders.js",
        "line": 41,
        "content": "let customer = await prisma.customer.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n                where: { \n                    OR: [\n                        { name: orde"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 31,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 69,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 112,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 155,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 190,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 252,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 271,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\adminTaskAutomationService.js",
        "line": 301,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 43,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 63,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 83,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 103,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 186,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\advancedNotificationService.js",
        "line": 263,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 1326,
        "content": "const recentOrder = await this.prisma.order.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: {\n          customerId: customerId,\n          createdAt: {\n            gt"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3376,
        "content": "const learningData = await this.learningService.prisma.learningData.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: {\n          conversationId: conversationId,\n          type: 'conversation"
      },
      {
        "file": "src\\services\\authService.ts",
        "line": 343,
        "content": "const user = await this.prisma.user.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n      where: {\n        // resetToken: token,\n        // resetTokenExpiry: { gt: new Date"
      },
      {
        "file": "src\\services\\autoResponseScenariosService.js",
        "line": 31,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\autoResponseScenariosService.js",
        "line": 105,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\autoResponseScenariosService.js",
        "line": 175,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\autoResponseScenariosService.js",
        "line": 267,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\autoResponseScenariosService.js",
        "line": 307,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationAnalysisService.js",
        "line": 274,
        "content": "companyId: 'cmdt8nrjq003vufuss47dqc45'",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdt8nrjq003vufuss47dqc45'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 51,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 80,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 109,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 133,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 155,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 177,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 212,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\conversationDistributionService.js",
        "line": 225,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 43,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 64,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 85,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 106,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 127,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 148,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 169,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 190,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 247,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 266,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 285,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 307,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\customKPIService.js",
        "line": 320,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 163,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 206,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 819,
        "content": "companyId: '1', // This would come from user data",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 847,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 470,
        "content": "let product = await this.prisma.product.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: {\n          name: {\n            contains: productName,\n            mode: "
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 486,
        "content": "product = await this.prisma.product.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n            where: {\n              OR: [\n                {\n                  name: {\n   "
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 31,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 61,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 91,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 121,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 168,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 185,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 202,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 226,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\escalationRulesService.js",
        "line": 242,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 30,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 71,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 109,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 150,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 215,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 238,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 260,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 283,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 304,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 318,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 341,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\followUpAutomationService.js",
        "line": 355,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 35,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 48,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 66,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 130,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 222,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 245,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 264,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 275,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\messageSchedulingService.js",
        "line": 286,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 30,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 81,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 129,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 170,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 216,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\modelTrainingService.js",
        "line": 248,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\notificationSettingsService.js",
        "line": 104,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\notificationSettingsService.js",
        "line": 199,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\notificationSettingsService.js",
        "line": 254,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\notificationSettingsService.js",
        "line": 271,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\outcomeTracker.js",
        "line": 340,
        "content": "const existing = await this.prisma.responseEffectiveness.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: {\n          messageId: effectivenessData.messageId,\n          conversatio"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 647,
        "content": "const conversationOutcome = await this.prisma.conversationOutcome.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n          where: {\n            conversationId: usage.conversationId,\n            created"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 202,
        "content": "const product = await this.prisma.product.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where,\n        include: {\n          category: true,\n          variants: {\n      "
      },
      {
        "file": "src\\services\\promptManagementService.js",
        "line": 248,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\ragService.js",
        "line": 48,
        "content": "const activeKey = await prisma.geminiKey.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: { isActive: true }"
      },
      {
        "file": "src\\services\\reminderService.js",
        "line": 95,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reminderService.js",
        "line": 122,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reminderService.js",
        "line": 149,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reminderService.js",
        "line": 185,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reminderService.js",
        "line": 196,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 78,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 120,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 146,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 168,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 186,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\reportExportService.js",
        "line": 219,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\responseOptimizationService.js",
        "line": 596,
        "content": "companyId: 'cmdt8nrjq003vufuss47dqc45'",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: 'cmdt8nrjq003vufuss47dqc45'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 91,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 110,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 129,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 148,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 167,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 186,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 205,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 224,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 243,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\services\\templateService.js",
        "line": 262,
        "content": "companyId: '1',",
        "description": "companyId مُثبت في الكود",
        "severity": "WARNING",
        "match": "companyId: '1'"
      },
      {
        "file": "src\\shared\\base\\BaseRepository.ts",
        "line": 213,
        "content": "const entity = await this.model.findFirst({",
        "description": "findFirst بدون فحص companyId",
        "severity": "WARNING",
        "match": "findFirst({\n        where: { [field]: value }"
      }
    ],
    "suspiciousPatterns": [
      {
        "file": "src\\domains\\ai\\controllers\\AIController.ts",
        "line": 312,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 386,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\domains\\auth\\middleware\\authMiddleware.ts",
        "line": 36,
        "content": "const user = await prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\domains\\auth\\middleware\\authMiddleware.ts",
        "line": 173,
        "content": "const user = await prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\domains\\auth\\services\\AuthService.ts",
        "line": 232,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\domains\\auth\\services\\AuthService.ts",
        "line": 270,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\domains\\auth\\services\\AuthService.ts",
        "line": 326,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\index.ts",
        "line": 277,
        "content": "const conversation = await prisma.conversation.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\middleware\\auth.ts",
        "line": 58,
        "content": "const user = await prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 92,
        "content": "resource = await prisma.order.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 99,
        "content": "resource = await prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 106,
        "content": "resource = await prisma.customer.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 113,
        "content": "resource = await prisma.conversation.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 68,
        "content": "resource = await prisma.order.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 75,
        "content": "resource = await prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 82,
        "content": "resource = await prisma.customer.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 89,
        "content": "resource = await prisma.conversation.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\middleware\\superAdminMiddleware.js",
        "line": 22,
        "content": "const user = await prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\middleware\\validation.js",
        "line": 465,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\invoiceRoutes.js",
        "line": 227,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\paymentRoutes.js",
        "line": 217,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\paymentRoutes.js",
        "line": 231,
        "content": "invoice = await prisma.invoice.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 140,
        "content": "const product = await prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 663,
        "content": "const categoryById = await prisma.category.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1147,
        "content": "const variant = await prisma.productVariant.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1237,
        "content": "const product = await prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 1358,
        "content": "const product = await prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 41,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 125,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\subscriptionRoutes.js",
        "line": 211,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 855,
        "content": "const pattern = await prisma.successPattern.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1335,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 66,
        "content": "const invoice = await prisma.invoice.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 124,
        "content": "const invoice = await prisma.invoice.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 143,
        "content": "const walletNumber = await prisma.walletNumber.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 126,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 209,
        "content": "const customer = await this.prisma.customer.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n          where: { id:"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 196,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 333,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 794,
        "content": "const company = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n          where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 2474,
        "content": "const product = await this.prisma.product.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 2994,
        "content": "const keyRecord = await this.prisma.geminiKey.findUnique({ where: { id: keyId } });",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({ where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3103,
        "content": "const keyRecord = await this.prisma.geminiKey.findUnique({ where: { id: keyId } });",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({ where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3127,
        "content": "const keyRecord = await this.prisma.geminiKey.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3186,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({ where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3998,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({ where: { id:"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 4057,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({ where: { id:"
      },
      {
        "file": "src\\services\\authService.ts",
        "line": 207,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\authService.ts",
        "line": 238,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\services\\authService.ts",
        "line": 274,
        "content": "const user = await this.prisma.user.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n      where: { id:"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 81,
        "content": "customer = await this.prisma.customer.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n          where: { id:"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 167,
        "content": "const conversation = await this.prisma.conversation.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 387,
        "content": "const completeOrder = await this.prisma.order.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 1017,
        "content": "const order = await this.prisma.order.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\orderService.js",
        "line": 63,
        "content": "const orderWithCustomer = await prisma.order.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\orderService.js",
        "line": 148,
        "content": "const customer = await prisma.customer.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\outcomeTracker.js",
        "line": 394,
        "content": "const conversation = await this.prisma.conversation.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 318,
        "content": "const pattern = await this.prisma.successPattern.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n          where: { id:"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 663,
        "content": "const pattern = await this.prisma.successPattern.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 689,
        "content": "const pattern = await this.prisma.successPattern.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 961,
        "content": "successRate: (newPattern.strength + (await this.prisma.successPattern.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 1034,
        "content": "const companyExists = await this.prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n            where: { id:"
      },
      {
        "file": "src\\services\\planLimitsService.js",
        "line": 50,
        "content": "const company = await prisma.company.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      },
      {
        "file": "src\\services\\subscriptionRenewalService.js",
        "line": 310,
        "content": "const subscription = await prisma.subscription.findUnique({",
        "description": "findUnique بـ ID فقط - قد يحتاج عزل",
        "severity": "SUSPICIOUS",
        "match": ".findUnique({\n        where: { id:"
      }
    ],
    "goodPractices": [
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 28,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 32,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 36,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 41,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 53,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 373,
        "content": "where: { companyId: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 428,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: id,\n          companyId: companyId"
      },
      {
        "file": "src\\controllers\\continuousLearningController_old.js",
        "line": 479,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: id,\n          companyId: companyId"
      },
      {
        "file": "src\\controllers\\hybridAiController.js",
        "line": 162,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\controllers\\hybridAiController.js",
        "line": 301,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\ai\\controllers\\AIController.ts",
        "line": 161,
        "content": "where: { companyId: user.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: user.companyId"
      },
      {
        "file": "src\\domains\\ai\\controllers\\AIController.ts",
        "line": 224,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        conversationId,\n        conversation: {\n          companyId: user.companyId"
      },
      {
        "file": "src\\domains\\ai\\controllers\\AIController.ts",
        "line": 291,
        "content": "where: { id: customerId, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: customerId, companyId"
      },
      {
        "file": "src\\domains\\ai\\controllers\\AIController.ts",
        "line": 313,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 306,
        "content": "where: { id: customerId, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: customerId, companyId"
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 326,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 387,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\domains\\ai\\services\\GeminiService.ts",
        "line": 544,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 108,
        "content": "where: { id: campaignId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 181,
        "content": "where: { id: campaignId, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 202,
        "content": "where: { id: campaignId, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 263,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 273,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 282,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 290,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 343,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 349,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            campaign: {\n              companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 531,
        "content": "where: { id: campaignId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 556,
        "content": "where: { id: campaignId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 581,
        "content": "where: { id: campaignId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: campaignId, companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 608,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\broadcast\\services\\BroadcastService.ts",
        "line": 640,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 146,
        "content": "where: { id, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 206,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            email: customerData.email,\n            companyId: customerData.companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 252,
        "content": "where: { id, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 262,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            email: updateData.email,\n            companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 305,
        "content": "where: { id, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 332,
        "content": "where: { id: customerId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: customerId, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 413,
        "content": "where: { id: noteData.customerId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: noteData.customerId, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 447,
        "content": "where: { id: customerId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: customerId, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 485,
        "content": "where: { id: customerId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: customerId, companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 551,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 586,
        "content": "this.prisma.customer.count({ where: { companyId } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 587,
        "content": "this.prisma.customer.count({ where: { companyId, status: 'ACTIVE' } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 588,
        "content": "this.prisma.customer.count({ where: { companyId, status: 'LEAD' } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 590,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n            companyId"
      },
      {
        "file": "src\\domains\\customers\\services\\CustomerService.ts",
        "line": 596,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 144,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId_platform_externalId: {\n            companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 252,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          pageId,\n          companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 266,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 409,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId: integration.companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 433,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId: integration.companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 507,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            // externalId: messageId,\n            conversation: {\n              companyId: "
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 536,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversation: {\n            companyId: integration.companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 588,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 615,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\integrations\\services\\FacebookService.ts",
        "line": 636,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 166,
        "content": "where: { id, companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 205,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            sku: productData.sku,\n            companyId: productData.companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 268,
        "content": "where: { id, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 278,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            sku: updateData.sku,\n            companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 323,
        "content": "where: { id, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id, companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 349,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 390,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 424,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          name: categoryData.name,\n          companyId: categoryData.companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 462,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: categoryId,\n          companyId: companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 475,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            name: categoryData.name,\n            companyId: companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 516,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: categoryId,\n          companyId: companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 557,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 632,
        "content": "where: { id: productId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: productId, companyId"
      },
      {
        "file": "src\\domains\\products\\services\\ProductService.ts",
        "line": 696,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\index.ts",
        "line": 122,
        "content": "where: { companyId }, // إضافة فلترة الشركة",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\index.ts",
        "line": 206,
        "content": "where: { conversation: { companyId: req.user?.companyId } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { conversation: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\middleware\\auth.ts",
        "line": 198,
        "content": "if (resource && resource.companyId !== req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 15,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 24,
        "content": "req.companyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 30,
        "content": "if (requestedCompanyId !== req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 33,
        "content": "userCompanyId: req.user.companyId,",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\comprehensiveIsolation.js",
        "line": 82,
        "content": "const userCompanyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 12,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 21,
        "content": "req.companyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 27,
        "content": "if (requestedCompanyId !== req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\dataIsolation.js",
        "line": 57,
        "content": "const userCompanyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\globalSecurity.js",
        "line": 197,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\globalSecurity.js",
        "line": 207,
        "content": "req.companyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\globalSecurity.js",
        "line": 213,
        "content": "if (requestedCompanyId !== req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\globalSecurity.js",
        "line": 216,
        "content": "userCompanyId: req.user.companyId,",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\globalSecurity.js",
        "line": 230,
        "content": "console.log(`✅ [COMPANY-ISOLATION] Company access granted: ${req.user.companyId}`);",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\validation.js",
        "line": 453,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\validation.js",
        "line": 466,
        "content": "where: { id: req.user.companyId },",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\middleware\\validation.js",
        "line": 466,
        "content": "where: { id: req.user.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: req.user.companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 27,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 33,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 39,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 179,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n              companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 185,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n              conversation: { companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 191,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n              companyId"
      },
      {
        "file": "src\\routes\\adminAnalyticsRoutes.js",
        "line": 200,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 289,
        "content": "prisma.user.count({ where: { companyId: id, isActive: true } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 290,
        "content": "prisma.customer.count({ where: { companyId: id } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 291,
        "content": "prisma.product.count({ where: { companyId: id, isActive: true } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 293,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n          companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 299,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n          companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 305,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n          companyId"
      },
      {
        "file": "src\\routes\\companiesRoutes.ts",
        "line": 311,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n          companyId"
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 483,
        "content": "companyId: req.user.companyId // Company isolation",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\enhancedOrders.js",
        "line": 480,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        orderId: id,\n        order: {\n          companyId: req.user.companyId"
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 392,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\index.ts",
        "line": 448,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\invoiceRoutes.js",
        "line": 228,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 108,
        "content": "companyId: req.user.companyId, // Company isolation",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 183,
        "content": "companyId: req.user.companyId, // Company isolation",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 218,
        "content": "companyId: companyId || req.user.companyId,",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 54,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 106,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        id: notificationId,\n        companyId: req.user.companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 143,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId: companyId"
      },
      {
        "file": "src\\routes\\notifications.js",
        "line": 181,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        id: notificationId,\n        companyId: req.user.companyId"
      },
      {
        "file": "src\\routes\\paymentRoutes.js",
        "line": 218,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 25,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 106,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\prioritySettingsRoutes.js",
        "line": 254,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n        id: reportId,\n        companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 403,
        "content": "companyId: req.user.companyId // Company isolation",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 212,
        "content": "where: { companyId: user.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: user.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 312,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: id,\n          companyId: user.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 401,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n                categoryId: duplicate.id,\n                companyId: req.user.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 474,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: id,\n          companyId: user.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 560,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            name: productData.category,\n            companyId: companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 653,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            name: updateData.category,\n            companyId: updateData.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 672,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n                companyId: updateData.companyId"
      },
      {
        "file": "src\\routes\\productRoutes.js",
        "line": 775,
        "content": "where: { product: { companyId: req.user?.companyId } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { product: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 221,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 229,
        "content": "const companyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 326,
        "content": "if (!req.user || !req.user.companyId) {",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 334,
        "content": "const companyId = req.user.companyId;",
        "description": "استخدام companyId من المستخدم - جيد",
        "match": "req.user.companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 42,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 126,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 150,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 245,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\settingsRoutes.js",
        "line": 349,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\subscriptionRoutes.js",
        "line": 212,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\subscriptionRoutes.js",
        "line": 261,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\subscriptionRoutes.js",
        "line": 318,
        "content": "where: { id: existingSubscription.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: existingSubscription.companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 432,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 443,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 620,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 680,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1176,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1193,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1246,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1252,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1263,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1284,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1336,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1349,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1353,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1360,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1416,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\routes\\successLearning.js",
        "line": 1435,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId: duplicate.companyId"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 43,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 184,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 290,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\routes\\walletPayment.js",
        "line": 311,
        "content": "where: { companyId: req.user?.companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: req.user?.companyId"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 66,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 127,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 138,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 662,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          id: productId,\n          companyId"
      },
      {
        "file": "src\\services\\advancedProductService.js",
        "line": 701,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 197,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 212,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 334,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 345,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 364,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\advancedPromptService.js",
        "line": 370,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 744,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            isActive: true,\n            companyId: companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 773,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 795,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 2620,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          isActive: true,\n          companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 2896,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          isActive: true,\n          companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3050,
        "content": "where: { companyId: targetCompanyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3138,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId: keyRecord.companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3186,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3205,
        "content": "where: { companyId: company.id }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3418,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 3998,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 4005,
        "content": "where: { companyId: company.id }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 4011,
        "content": "where: { companyId: company.id },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 4057,
        "content": "const company = await this.prisma.company.findUnique({ where: { id: companyId } });",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\aiAgentService.js",
        "line": 4066,
        "content": "where: { companyId: company.id }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\aiQualityEvaluator.js",
        "line": 41,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 457,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 464,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 471,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 478,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 485,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 502,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 511,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 523,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 529,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 535,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 541,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\analyticsService.js",
        "line": 676,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\autoPatternDetectionService.js",
        "line": 149,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 126,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 148,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 170,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 219,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 242,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId: { in: overdueInvoices.map(inv => inv.companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 277,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 298,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 319,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 353,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId: { in: expiredTrials.map(sub => sub.companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 382,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\billingNotificationService.js",
        "line": 631,
        "content": "where: { companyId: { not: null } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\continuousLearningServiceV2.js",
        "line": 94,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\continuousLearningServiceV2.js",
        "line": 262,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 518,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId: filters.companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 524,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId: filters.companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 561,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId: filters.companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 567,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            conversation: { companyId: filters.companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 597,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversation: { companyId: filters.companyId"
      },
      {
        "file": "src\\services\\dashboardService.js",
        "line": 635,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversation: { companyId: filters.companyId"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 96,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n            phone: data.customerPhone,\n            companyId: data.companyId"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 193,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n        companyId: companyId"
      },
      {
        "file": "src\\services\\enhancedOrderService.js",
        "line": 660,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId: conversation.companyId"
      },
      {
        "file": "src\\services\\inventoryService.js",
        "line": 137,
        "content": "where: { product: { companyId: req.user?.companyId || companyId } },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { product: { companyId: req.user?.companyId || companyId"
      },
      {
        "file": "src\\services\\inventoryService.js",
        "line": 668,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          productId,\n          warehouseId,\n          // Add company isolation by getting i"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 94,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversationId,\n          senderId,\n          companyId, // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 147,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          senderId,\n          companyId // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 243,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversationId,\n          senderId,\n          companyId // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 454,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          senderId,\n          companyId // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 500,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversationId,\n          senderId,\n          companyId // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 557,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          conversationId,\n          senderId,\n          companyId, // ✅ إضافة companyId"
      },
      {
        "file": "src\\services\\memoryService.js",
        "line": 671,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          OR: [\n            { companyId"
      },
      {
        "file": "src\\services\\multimodalService.js",
        "line": 56,
        "content": "where: { companyId: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: companyId"
      },
      {
        "file": "src\\services\\multimodalService.js",
        "line": 102,
        "content": "where: { companyId: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: companyId"
      },
      {
        "file": "src\\services\\orderService.js",
        "line": 112,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          name: productName,\n          companyId"
      },
      {
        "file": "src\\services\\orderService.js",
        "line": 301,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\outcomeTracker.js",
        "line": 447,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 35,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 358,
        "content": "where: { patternId, companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { patternId, companyId"
      },
      {
        "file": "src\\services\\patternApplicationService.js",
        "line": 730,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\patternCleanupService.js",
        "line": 44,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\patternCleanupService.js",
        "line": 247,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 142,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 222,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 232,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 242,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n            companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 829,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\patternDetector.js",
        "line": 1035,
        "content": "where: { id: companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\planLimitsService.js",
        "line": 51,
        "content": "where: { id: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { id: companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 150,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 262,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 315,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 360,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 407,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 459,
        "content": "this.prisma.product.count({ where: { companyId } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 460,
        "content": "this.prisma.product.count({ where: { companyId, isActive: true } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 461,
        "content": "this.prisma.product.count({ where: { companyId, isActive: true, stock: { lte: 0 } } }),",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\productSearchService.js",
        "line": 462,
        "content": "this.prisma.category.count({ where: { companyId } })",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\productsPromptBuilder.js",
        "line": 50,
        "content": "where: { companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\promptEnhancementService.js",
        "line": 160,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\ragService.js",
        "line": 147,
        "content": "where: { companyId: companyId },",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId: companyId"
      },
      {
        "file": "src\\services\\ragService.js",
        "line": 327,
        "content": "// const faqs = await prisma.faq.findMany({ where: { companyId } });",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\ragService.js",
        "line": 365,
        "content": "// const policies = await prisma.policy.findMany({ where: { companyId } });",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\responseOptimizer.js",
        "line": 488,
        "content": "where: { companyId }",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { companyId"
      },
      {
        "file": "src\\services\\scheduledPatternMaintenanceService.js",
        "line": 180,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\scheduledPatternMaintenanceService.js",
        "line": 233,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\smartProductService.js",
        "line": 31,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: { \n          companyId"
      },
      {
        "file": "src\\services\\successAnalyzer.js",
        "line": 39,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      },
      {
        "file": "src\\services\\successAnalyzer.js",
        "line": 50,
        "content": "where: {",
        "description": "استخدام companyId في where - ممتاز",
        "match": "where: {\n          companyId"
      }
    ],
    "filesScanned": 179,
    "totalIssues": 429
  }
}