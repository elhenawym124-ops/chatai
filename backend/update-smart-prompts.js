const { PrismaClient } = require('@prisma/client');

/**
 * ุชุญุฏูุซ ุงูู prompts ููููู ุฃูุซุฑ ุฐูุงุกู ูู ุงูุชุนุงูู ูุน ุงูุชุญูุงุช
 * ูููู ุจุชุญุฏูุซ personalityPrompt ู responsePrompt ููููู ุฃูุซุฑ ุฐูุงุกู
 */

async function updateSmartPrompts() {
  const prisma = new PrismaClient();
  
  try {
    console.log('๐ง ุจุฏุก ุชุญุฏูุซ ุงูู prompts ุงูุฐููุฉ...\n');
    
    // ุงูุญุตูู ุนูู ุฌููุน ุงูุดุฑูุงุช
    const companies = await prisma.company.findMany({
      select: { id: true, name: true }
    });
    
    console.log(`๐ ุชู ุงูุนุซูุฑ ุนูู ${companies.length} ุดุฑูุฉ\n`);
    
    // ุงูู prompts ุงูุฌุฏูุฏุฉ ุงูุฐููุฉ
    const smartPersonalityPrompt = `ุงูุชู ุงุณูู ุณุงุฑูุ ุจูุงุนู ุดุงุทุฑู ูุฐููุฉ
ุงุณููุจู ูุฏูุฏ ููููู
ุงุณุชุฎุฏูู ูุบู ุนุงููู ูุตุฑูุฉ 
ุงุณุชุฎุฏูู ุงูุงูููุฌู ุจุดูู ููุงุณุจ
ุฑุฏ ุจุงููุทููุจ ูุฎูููู ูุฎุชุตุฑู ููููุฏุฉ

โ๏ธ ููู ุฌุฏุงู: ุงูุฑุฃู ุฑุณุงูุฉ ุงูุนููู ุจุนูุงูุฉ ูุงุนุฑูู ุฅูู ุงููู ุจูุทูุจู:
- ูู ุจูุณูู ุนูููู ุจุณ (ูุฑุญุจุงุ ุงูุณูุงู ุนููููุ ุฃููุง) โ ุฑุฏ ุจุงูุชุญูุฉ ุจุณ ููุง ุชุนุฑุถู ููุชุฌุงุช
- ูู ุจูุณุฃู ุนู ููุชุฌุงุช ุฃู ุจูููู "ุนุงูุฒ" ุฃู "ุฃุฑูุฏ" โ ุงุนุฑุถู ุงูููุชุฌุงุช
- ูู ุจูุดูุฑู ุฃู ุจูููู "ูุน ุงูุณูุงูุฉ" โ ุฑุฏ ุจุงูุดูุฑ ุจุณ`;

    const smartResponsePrompt = `ุนูุฏ ุงูุฑุฏ ุนูู ุงูุนููุงุก:

๐ ุฃููุงู: ุงูุฑุฃู ุฑุณุงูุฉ ุงูุนููู ุจุนูุงูุฉ ูุงุนุฑูู ุฅูู ููุน ุงูุฑุณุงูุฉ:

๐ ุฃููุงุน ุงูุฑุณุงุฆู:
1. ุชุญูุฉ ุจุณูุทุฉ (ูุฑุญุจุงุ ุงูุณูุงู ุนููููุ ุฃููุงุ ููู ุงูุญุงู)
   โ ุฑุฏ ุจุงูุชุญูุฉ ุงููุฏูุฏุฉ ุจุณุ ูุง ุชุนุฑุถู ููุชุฌุงุช

2. ุดูุฑ ุฃู ูุฏุงุน (ุดูุฑุงุ ูุน ุงูุณูุงูุฉุ ุจุงู)
   โ ุฑุฏ ุจุงูุดูุฑ ุฃู ุงููุฏุงุน ุจุณุ ูุง ุชุนุฑุถู ููุชุฌุงุช

3. ุงุณุชูุณุงุฑ ุนู ููุชุฌุงุช (ุนุงูุฒุ ุฃุฑูุฏุ ุงูู ุนูุฏูุ ุงุนุฑุถูุ ุดู ุงููุชุงุญ)
   โ ุงุนุฑุถู ุงูููุชุฌุงุช ูุน ุงูุตูุฑ ูุงูุชูุงุตูู

4. ุฃุณุฆูุฉ ุนุงูุฉ (ุงุฒููุ ุดููููุ ููู ุงูุฃุญูุงู)
   โ ุฑุฏ ุจุดูู ูุฏูุฏ ุจุณุ ูุง ุชุนุฑุถู ููุชุฌุงุช

๐ก ููุงุนุฏ ุงูุนุฑุถ ุงูุฐูู:
- ุงุนุฑุถู ุงูููุชุฌุงุช ููุท ููุง ุงูุนููู ูุทูุจูุง ุตุฑุงุญุฉ
- ุงุณุชุฎุฏูู ุงูุณุคุงู ุงูููุชูุญ ููุง ุชุนุฑุถู ููุชุฌุงุช
- ุงุนุฑุถู ุตูุฑ ุงูููุชุฌุงุช ูุน ุงูุชูุงุตูู
- ุงูุดุญู 50 ูุฌููุน ุงููุญุงูุธุงุช ูุตุฑ
- ุงุณุชุฎุฏูู ูุนูููุงุช ุงูููุชุฌุงุช ุงูุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

๐ฏ ูุฏูู: ุชุนููู ุงูุฑุฏุฑ ูู ุงูุนููู ุจุฐูุงุก
- ุฎูู ูู ุฎุทูู ุชุณูู ุงูุฎุทูู ุงููู ุจุนุฏูุง
- ูู ูุนุงูู ุงูููุงุณ ุงุทูุจู ุงูููู ุนุดุงู ุชุฏุฎูู ูููุฑุญูู ุงููู ุจุนุฏูุง

๐ ุงูุจูุงูุงุช ุงููุทููุจู ูุชุณุฌูู ุงูุงูุฑุฏ:
ุงูุงุณู ูุงูุนููุงู ูุฑูู ุงูุชูููู ูุงูููู ูุงูููุงุณ ูุนุฏุฏ ุงููุทุน

๐ฐ ุชูุฏุฑู ุชุนููู ุฎุตู 15 ุฌููู ูู ุงูุนููู ุทูุจ ุงูุชุฑ ูู ูุทุนู

โ๏ธ ุชุฐูุฑู: ูุง ุชุนุฑุถู ููุชุฌุงุช ูุน ุงูุชุญูุงุช ุงูุจุณูุทุฉ!`;

    for (const company of companies) {
      console.log(`๐ข ูุนุงูุฌุฉ ุงูุดุฑูุฉ: ${company.name} (${company.id})`);
      
      // ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุฐูุงุก ุงูุตูุงุนู
      const aiSettings = await prisma.aiSettings.upsert({
        where: { companyId: company.id },
        update: {
          personalityPrompt: smartPersonalityPrompt,
          responsePrompt: smartResponsePrompt,
          updatedAt: new Date()
        },
        create: {
          companyId: company.id,
          autoReplyEnabled: true,
          autoSuggestProducts: true,  // ููุนู ููู ุจุฐูุงุก
          maxSuggestions: 2,
          includeImages: true,
          confidenceThreshold: 0.8,
          personalityPrompt: smartPersonalityPrompt,
          responsePrompt: smartResponsePrompt,
          escalationRules: '{}',
          modelSettings: JSON.stringify({
            smartResponseMode: true,
            greetingDetection: true,
            productSuggestionRules: {
              onlyWhenRequested: true,
              excludeGreetings: true,
              excludeGoodbye: true,
              excludeGeneralQuestions: true
            }
          })
        }
      });
      
      console.log(`   โ ุชู ุชุญุฏูุซ prompts ุงูุดุฑูุฉ ${company.name}`);
      console.log(`   ๐ง ุงูููุท ุงูุฐูู: ููุนู`);
      console.log(`   ๐ฏ ุงูุชุดุงู ุงูุชุญูุงุช: ููุนู`);
      console.log('');
    }
    
    console.log('\n๐ ุชู ุชุญุฏูุซ ุงูู prompts ุงูุฐููุฉ ุจูุฌุงุญ!');
    console.log('\n๐ ุงูุชุญุณููุงุช ุงููุทุจูุฉ:');
    console.log('   ๐ง ุงูุชุดุงู ููุน ุงูุฑุณุงูุฉ (ุชุญูุฉุ ุงุณุชูุณุงุฑุ ุดูุฑ)');
    console.log('   ๐ซ ุนุฏู ุนุฑุถ ููุชุฌุงุช ูุน ุงูุชุญูุงุช ุงูุจุณูุทุฉ');
    console.log('   โ ุนุฑุถ ููุชุฌุงุช ููุท ุนูุฏ ุงูุทูุจ ุงูุตุฑูุญ');
    console.log('   ๐ฏ ุฑุฏูุฏ ุฃูุซุฑ ุฐูุงุกู ูุทุจูุนูุฉ');
    
    console.log('\n๐ก ุงูุขู ุงููุธุงู ุณูุฑุฏ ุจุฐูุงุก:');
    console.log('   โข "ูุฑุญุจุง" โ "ุฃููุงู ุจูู! ุงุฒููุ ๐"');
    console.log('   โข "ุนุงูุฒ ููุชุดู" โ ูุนุฑุถ ุงูููุชุฌุงุช');
    console.log('   โข "ุดูุฑุง" โ "ุงูุนูู! ๐"');
    console.log('   โข "ุงูุณูุงู ุนูููู" โ "ูุนูููู ุงูุณูุงู ูุฑุญูุฉ ุงููู ๐ธ"');
    
  } catch (error) {
    console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูู prompts ุงูุฐููุฉ:', error);
  } finally {
    await prisma.$disconnect();
  }
}

// ุชุดุบูู ุงูุฏุงูุฉ
updateSmartPrompts();
